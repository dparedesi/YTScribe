---
video_id: 6autfsn1fy8
video_url: https://www.youtube.com/watch?v=6autfsn1fy8
is_generated: False
is_translatable: True
---

All right, welcome everyone. How's everyone doing? Alright, exciting announcements this morning from Matt. A lot of cool stuff going on, so we're gonna get right into it. This is a code talk. My name is Roland Barcia. I am the worldwide director for our specialist org. I lead all our specialist technologies, and I'm joined here by. Uh, Carlos Santana, he's gonna introduce himself, but I'm also gonna ask him why, why are you there? Why don't you clean up a little bit? Clean up what? Clean up the kitchen over there. Oh, clean the kitchen. Yeah, yeah, Roland, you know what, how I like to clean the kitchen at my house. I put salsa music with Alexa, right, like Oje comova quelindo Oje comova. Oh my God, I just I tripped over the broom with this uh fridge and now there's water everywhere and let me let me let me see if I can push the buttons here to fix it. No, no, no, my wife is going to kill me. She's getting, I'm getting, she's getting back from a trip and she's going to kill me like there's water everywhere like and now I have to tell her I was dancing salsa while, while grooming and kick the, the, the fridge. Hi Carlo. Hi hi yeah I. All right, so what do we need? We want to build an agent. Um, because, as people don't like talking to the sport cases, they, they take a while. I'm like, hey, you know what, instead of calling someone, I would love to build an agent to be able to give it some prompts around when people like Carlos, who's dancing salsa, by the way, I'm, I'm Cuban and he's Puerto Rican, so he probably his dancing breaks the refrigerator, right? I should be dancing I should be dancing the reggaeton. Oh, there you go, we're gonna build an agent and. Uh, I know we have a lot of business logic, but it's kind of locked up inside my existing containerized application. And so what are we gonna do? um, this gentleman Carlos who dances next to me is also a platform engineer, uh, Kubernetes expert, and this is just a little preview, right? We're gonna actually show it live in a minute, but basically I wanna be able to ask it some questions around, uh, you know, hi. How can you help me? There's a little bit of a preview. You kinda see some of the tools and existing systems that are there. That's, that's what we're gonna build and so give it a second and then we'll see we have things like claims, appointment services, account information, all deterministic logic I built years ago. Uh, and Carlos, who's, uh, exciting, uh, dancer here, is also a Kubernetes platform engineer, so they built all these things, um, together after years within a modern microservices based system using Kubernetes and so what we have a lot. Opportunity and a challenge around taking your existing applications, your existing legacy applications, and kind of exposing them, uh, through MCP or other mechanisms, um, there's different options and you're living now with nondeterministic logic and deterministic logic, right? You have. Years and years of like applications that were built to be reused and now I wanna make use of them in an agentic world so how we're gonna do that tomorrow we have an architecture session or I do at at 6 o'clock I think at the Wynn where we go more on the architecture issues between different options for creating MCP servers, exposing existing applications, different ways to do that, but here we're just gonna get into a very specific way, so, uh, you know. Exposing your existing assets is a great way to kind of make uh your existing agents and automate things as well with the architecture we're we're gonna get into Agent Core. I'm an agent developer. I write Python. I like to write agents. I don't know Kubernetes. I don't know uh the existing microservices architecture could have been written in Java or something. I don't know, but we use Agent Core. Agent Core, uh, has a lot of components, a lot of sessions this week. I primarily run my agents inside of Agent Corre runtime. I use things like Agent core identity to kind of make sure I have access to things. I wanna use Agent Corre Gateway as well so I can access all the nice tools that I might have in my agenttic systems. I wanna use memory to keep track of different conversations so we're gonna use these components uh not listed or new announcements like evaluations and the policies that exist inside of Gateway won't be showing those today but we will kind of get into some of the code and of course. EKS EKS, I love EAS. Yes, wanna talk a little bit about it? No, go ahead, go ahead. Alright, so, uh, with EKS, uh, Kubernetes is still super important. We have one of the best Kubernetes platforms out there with the most instance types, a lot of new exciting features. Last year we had auto mode. This year we have was there's some announcements. EKS. We are just launched EKS capabilities, so that's a fully managed Argo CD. Crow and ACK and those bots running our endless services you just see the CRD. So this allows platform engineering teams to not worry about scaling or maintaining or patching these controllers. Uh, some of them like the CNCF Argo see this part of the CNCF. So we're taking care of that, of that compute. You don't have to pay for that compute and then you just concentrate on deploying the, the apps with, with Gitups, uh, and that could be ACK or Chrol to deploy. Infrastructure it could be a BPC. It could be an S3 bucket, and that's one of the major announcements that we did this, uh, uh, recently also, uh, provisioning, uh, control planes, uh, pre-provision control planes to allow at scale on demand like big clusters, a lot of are nodes. Uh, another one is around N EKS MCP server hosted so you can connect things like Qiro or our agents in strands right to connect it to do DevOps, uh, uh, agentic DevOps. Awesome. So what's the architecture we're gonna build? We're gonna have a simple chat UI because all AI demos have a chat interface where you prompt against it. So, um, and you're gonna have existing microservices APIs with EKS. We're gonna expose that through the gateway and use agent core identity to make sure I have secure access to these services. Uh, and then I'm gonna deploy my agent core runtime, um, application. I use strands as the SDK to deploy that. We're also gonna expose the agent itself A to A, which is something you can do inside of agent agent core runtime. Today it's just being consumed by the chat UI, but you can envision in the future this orchestration living next to other orchestrations, etc. so we wanna be prepared for that as well. And of course we're gonna use Bedrock to do inference in our models as well. And so this is the architecture we're gonna show some of the code with that. Um, Carlos, you have a bunch of microservices. I wanna use these systems. You told me that, you know, I don't have to learn Kubernetes because you're gonna just give me some nice tools through MCP with the code and expose those existing systems. So you're gonna show the audience how we did that with code, yeah, yeah, because, uh, the scenario is the our, our management told us like that we have to make everything MCP available or our. Microservices and some of these systems have like hundreds of microservices, right? So if my team is going just to spend time writing MCP servers and wrappers and another wrapper like it will take us a full year. So why not, uh, uh, take advantage of the MCP gateway or agent core. So that's what we're going to show on some of those microservices being used, uh, from the EKS server, uh, EKS cluster. Awesome. So today, like I'm gonna play the role of the agent developer. I just wanna get access to my tools and use them. I wanna write my agents. I wanna write prompts. I do prompt engineering and Carlos, you're the platform engineer, right? And you're gonna go ahead and uh take the existing systems and make them available to me as tools and we're gonna do, we're gonna do that today so you're gonna start with the infrastructure, right? Yeah, alright, so, well, we'll, we'll show you the, the, the ECAS cluster in this case we're using ECAS auto, uh, that we show and some of the practices that a lot of, uh, customers use to deploy microservices. They use an ingress. They use a deployment service annotations, very easy to deploy these microservices and then expose them through a low balancer and then use the gateway to, um, um, access that, that microservices, but having a contract and that contract comes from the. Open API. So we'll go more deeper into that. But then the agent core runtime, we need to make sure that uh the our Roland's agent is the only one talking to my services. I don't want other agents around there just talking to the MCP gateway. So there's another service uh feature for Agent Core called Identity that will handle that token exchange, uh, with the provider to be able to connect to, uh, the MCP, uh, server that actually gets created on the fly with one URL. Awesome. One of the cool things about, uh, Agent Core Gateway is it can talk to existing MCP servers, and you can have semantic search so you can search across hundreds and hundreds of tools and make sure that you're getting the tool you need. You can also expose existing assets like your lambda functions, and if you describe things with swagger, open API spec automatically converts them to MCPs. Servers, it's not the only way. Sometimes you use cases you wanna code existing MCP servers, uh, but in this case I need this agent code done, right? So as an agent developer I just wanna use my tools. I wanna use Bedrock's LLMs. I wanna write my agent run time. I wanna access them and I wanna use identity to make sure I can access these tools securely. And so we're gonna combine these things and we're gonna show some of the code and some of the application stuff that we've written and then we'll actually show this live hopefully it'll work with demo so we're gonna switch over now to the demo. Are you ready? Yeah, let's go a little bit of uh code who wants to see some code? That's why you're here. It's a cold talk, right? Let's go. Um, so let me show you what we have. Um, let me go to the console and I have my home here and let me check, um, if my ECA cluster. Is ready here. So as you can see here, I have an uh IAS cluster and it's configured. Let me close a few of these windows and we're using 133 and this is something so we can show like if I want to upgrade, right, I will do um I insights. I mean, uh, this is the new capability that we announced we're getting our pop-up so this is good that it's working and you can check it out. Um, from there, and then, um, IAS auto, right, so IAS auto mode is enabled as you can see here, and, uh, we'll have our compute. That is here Um, and these nodes are coming from not pulls. So we are, uh, auto mode. IAS uses something called Carpenter, uh, uh, who uses Carpenter in their ICAS clusters, right? Um, so Carpenter is uh the auto scaling that automatically provisions your notes based on pots that are pending, um, and that way you don't have to, uh, it's, it's a much easier way of managing those. Uh, what else we have here, um, so it's, yeah, this is a, a vanilla, uh, one, add-ons, uh, I have one called external DNS. Uh, this allow us to basically, um, add a domain name to my ingress when I create an ingress or a service. Uh, external DNS is part of the, of the CNCF, um, and. And one thing is we recently added uh ECAS community add-ons, so things like external DNS cert manager, grip state metrics um these are add-ons that gets deployed through ECAS add-ons API, and these are things that you don't have to do it through helm chart container images that you have to scan. Um, maybe checking that the compatibility is, uh, broken between the version of Kubernetis and these atoms. So a lot of our customers are like now switching from self-managed helm charge deploying these, uh, ICAS communities to deploying them through the ICAS atom, and you can do that with ACK, cloud formation, terraform, uh, anything that handles the or the CLI that handles the API. So that's our cluster here, um, oh, I can show the capabilities right that we sure. Uh, here's the capabilities that you can add things like Argo CD, ACK, and Curl. So just giving you an overview of all we have, and this is like me, the platform engineer, uh, having to managed to a fleet of clusters. So usually in a, in, in a, in a business we have multiple eCAS clusters, pre-proud and proud, and having this, this in here, uh, help us a lot. Let me show you one more thing. I think I was uh upgrade insights, um, so as you saw it was 133, but there's upgrade insights that we give you of like what are the things you're ready to upgrade or there's something warning or or block something that will block you from from upgrading. So that's my cluster. So let's go to uh the console here to see what are my microservices that I'm deploying so I can show here an example of, uh, those. Uh, microservices on their infrastructure. So, uh, you're going to have access to this, uh, code. So basically it's going to be divided into two, sections. Uh, one section is agents and another section is called infrastructure. So Roland have been working in the agent folder, right? And I've been working on the infrastructure folder, um, and then on the infrastructure folder we have like our manifest. So for example I'm using, uh, um, there's main two ways or top most popular two ways of deploying City, uh, resources is customize and helm in this case I'm. Using um customized, so I have here like Roland pointed out in the architecture right appointments customer and and technician. So, uh, it has their typical deployment with the container image that has the, the res API to getting the appointments, creating appointments. It has a service and then it has an ingress and this is what I wanted to show. Uh, that, uh, this is how you expose how you want to expose the, the low balancer. So when you create this, it will actually create a low balancer, and this ingress points to, uh, the ser the service, right, the service that I just showed here, uh, on this service, and then it will add an annotation, uh, to for the host name. So let's look at how that looks like in. Uh, cube CDL. Who calls CPCTL CIP control? OK, I always call it QC, we call it QCTL. And who just use queue, OK. Uh, so if I do get pots, um, let's see the notes, right, how many, how many notes I have here. Let me check on time. How are we doing? Oh, we have plenty of time. Uh, so these are the notes. Um, these notes are provisioned by the note group, so if I do get, um, is that a good fund? Size or make it bigger. OK, I can make it a little bit bigger. Is that OK? OK, so, um. And K, for those of you, I think some of you raise your hand. K is just, uh, it's, it's an alias to keepsy tail. It's just so many years of using it that my brain is just use k, um, so we have no pools. And these are the Carpenter pools. So, um, and, and, and the thing is Carpenter is not running as a pod in here because it's auto mode. So Carpenter is, uh, managed by the EKS service, so you don't have to install it. No helm charts. It just runs in auto mode. And then these instances are managed, meaning that, uh, they, we will handle the rotation of those, uh, AMIs. So we're going to handle the CV patching. So every no more than 21 days can run. Default is 14 days, but we're going to take care of rotating those, and those are running Bottle Rocket, which is our container rise operating system that we recommend for running EAS workloads because it has a low, uh, footprint of files and processes that makes us more secure. So these are the, the no pulls and um when you have no pulls and you have pots in pending it will create no claims so we do uh no claims. Claims and then these are like the instances. This is like carpenter going directly to the EU fleet API and getting the note as fast as possible and then the node gets created and then the the pod gets scheduled right the sche Kubernet schedule, uh, puts it here. So let's take a look of what we have in. Deployments, um, well, let's show all the pots so you can see like actually there's no if I do get, get, get pots a, um, there's no, uh, core DNS as you can see here who have a, um, um, a standard Kubernetis cluster not using it as auto. So usually you see things like a CNI demon set. You see things like core DNS, and these are things that are now in the node. So these are, these are pots that you don't have to worry about. So in here we see the external DNS that I show and then metric server, right? So if you have an HPA like we you want to, uh, uh, scale this based on metrics, uh, the number of pots, uh, right, you would use an HPA, a horizontal auto auto scaler. And you configure this HPA saying based on this CPU or memory or or at in a a custom metric I want to have this number of of pots and it will scale up, uh, scale out or scale in the number of of pots. So that's why Matric server is there, uh, guest book is I was testing the EAS capabilities to deploy, uh, from Argo CD that I have in a hub cluster in a different region deploying to this cluster. So it's, it's there. I was, uh, testing it. Um, but the thing that what I want to show was this, um, uh, 3 microservices that are in the deployment, um, thing. So if I do get, uh, deployments dash N. Uh, development. We have 3 deployments. So this is typically what our business do, right? So when the, when the management team came, came to us saying, hey, can we get, can you create MCP servers, we were saying, Well, do we like wrap this the same code again and create a Docker file and create an MCP servers and then I have 6 spots, right? Um, and then we discovered through our accounting, for example, uh, our time that Agent Core has this capability of MCP gateway, so we don't have to code the MCP servers. We can just take this, uh, APIs, have their documentation, their open API schema, uh, or, or Swagger, or we back in the days we used to call it Swagger. Now we have open API spec, uh, V3. Um, and with that information we can tell the MCP gateway how to access and what are the uh services available so they can reconvert it into MCP tools. So if I want to do this in this example, um, like I showed you, right, I have the ingress here. I can do k get ingress and then for the ingress usually prints the. The host name and the external DNS, uh, name that I configure in Route 53. So usually this is the easiest way to configure host names, uh, for when you create an English you put in a notation that you want to put the, the domain name for this application. So in this case I have appointments dash development, home insurance, um. Uh, demo cloud nativestart.com, that's just a, uh, domain name that I have available for, for demos. Then we have customer, um, and then we have technicians. So let's pick up one of the, uh, microservices and let's take a look at what is behind it. So if I open here and say docs. Who can tell me what is this? Who recognize this UI? Who have used it who have used it, OK, so for people recording there's a lot of people raising their hand, by the way, um, so this is a kind of a swagger, uh, we just call it swagger UI, I guess we call it now open spec UI, um, but these are like my micro services and this becomes appointments. So in the home insurance company, right, we have appointments and claims and customers. So customer create a claim. Uh, based on their policy and then if they have like a problem that we have with the fridge is still like running water in here on stage, oh my goodness, uh, we need someone to come in and fix it so we can just test it here to see if it works. I can just list what are the appointments that I have, uh, click here, and then execute it, right? Um, and then I get all my appointments. So this is a typical way that our current system right before Agentic, um, our, our customer service and everyone in the business used to access these APIs through another API, another UI standard forms that these are not gentic. This is the standard way that we have established and, uh, we have gone through change management every time we need to do an update and that's our. Process and most companies, uh, customers have a process of that like a change management of anything that you deploy so we have this and um if we want to see the Jason we can click here and we'll get our Jason but we can do pretty so this is a a a a way of describing uh the re API as you saw all those end points that get uh get I'm doing. Appointments. So like get an appointment, create an appointment, uh, delete an appointment list appointments. So this is like the standard way of creating this, uh, documentation and a lot of frameworks, right? Spring boot, uh, Express JS, we're using fast API, uh, have a way to generate this, this, uh, swagger or open spec API, but you can also use things like Kiro. You can ask Kiro, which are our, uh, gentic IDE or CLI, to inspect the source code and say generate me the open swagger for this file, right, or get me started, um, and, and start doing that. So but that's a requirement, uh, that we have and I'm going to show in a minute that there's something that for MCP gateway that is not, not in here. So if I search, let me see if it's here. If I search for server, um, in the, in the spec there's a field called server which has a URL so the MCP we're going to give this JSON file to the MCP gateway to access this API, but it needs the address. So one way, uh, the way to express the location of this rest API, right, if it's going to be development versus production, maybe I have two domain names, um, or a path-based, uh, routing. Um, it would, it would, um, it would know how to call it, so we're going to show the code how we inject that, uh, how we're doing, we're good, we're good. So, um, so, so good so far, right? So if you have microservices they're up and running. You need a, a swagger file, a Jason file, and we need to inject the URL. So I'm going to do it, uh, with code, and then let's see how we can expose this on the MCP gateway. So let's go to, uh, Kiro. I'm using the Kiro IDE. Actually this almost all this code uh was uh working me Kiro back and forth uh uh creating this this code so he's aware of what things are happening here so let me go and show you. Um, and this code, when you get it, it will have a lot of test, uh, files, uh, because, uh, I use Quiro and as a spec driven development, uh, Quiro created all these test files to make sure that the requirement that I put into the beginning was met as we developed the this, this demo code. But in this case I'm going to go to the MCP gateway Python Python folder source and I have set up. PY. Um, and then I have a pipe project. So we're using, um, Python to create the, the gateway and this infrastructure, but you can use whatever other infrastructure as tool as code that you have like things like ACK in this case that we were talking about cloud formation, terraform, the, the CLI, whatever you have in this case I'm just going to show, uh, Botore, right, the Python STK. So let me show, go here um and open the, I have the terminal so big that I'm going to make it a little bit smaller. And uh pipe project is basically like the entry point to this thing. So I have a uh entry point called MCP gateway set up that is going to use the source setup um setup. Python code and the main function. So if I run, uh, that just need to grab it, go to this directory here. I mean that directory, right? So if I do, I see the project in there if I do LS source. Right, here's all the things that I was testing like um the different pieces to create the MCP gateway but setup.py is setting up the MCP gateway. So if we look at the code, I think I had it up. In here, let me find my main function. So this little uh uh code and I have some motility uh helper functions just to speed up things because we don't have enough time to cover everything but um let me find the the main function right so this is the main function so if I run this script it would ask you it would you can pass two parameters the rest API domain name so you can use some when you run this, uh, when you get back home. Um, or tonight you can run it and you pass a domain name. In this case it was cloud nativestart.com, remember, um, and then I will pass the environment if I'm going to deploy the development, uh, name space or the production name space. But also a lot of customers have this, this, uh, environments in separate, uh, IAS cluster. They have a pre-proud cluster and a production cluster. So for demo purposes I'm using, uh, name spaces. So you pass those two things and then we're going to start using the bottle 3 library uh to do that and then the first thing that we do is create an MCP gateway and to create an MCP gateway we need an AIM, uh, IIM role, uh, for the MCP gateway service, right? The instance of the MCP gateway is going to be, um, have, uh, need identity like an AI role and the documentation shows that. So I have a function that just create. And I enroll with the right AM policy and I get that I enroll. The next thing that I do is, um, get a cognito. So this is how I'm going to protect the MCP gateway uh for Roland when he creates the agent and he's going to access the MCP gateway. It's going to be an inbound from the agent core from the agent to the MCP gateway. So in this case I'm using Cognito, uh, to protect it. So this function, I think I have it here to the definition. So this function basically creates it, it checks if I already have it created like for demo purposes. If, if it's not, it will create it like. Um, and then I would, it would, it would need things like what is the cognito, uh, pool resource server ID, resource server name. So this is basically like this, the to handle the scope. So if you want to read versus write, um, the scopes are down here that I want to define. And then basically I create that and I get back the information that I need to return like what is the user pool ID, the client ID, the client secret, the cognito discovery URL, um, the token URL where you're going to get a token from that cognito service, and then the resource server ID where the scopes need to match when you ask for a token. So let's go back to the main. Uh, down here, where's the main, main, I forgot the line number. Um, so, Create the MCP. So I cognito is created. Then, um, I'm going to create the gateway. So there's an API and the things that you need to pass to this gate uh gateway is, uh, uh, 3 things and take into account that you create a gateway first and then you do your targets. So you, you can create a gateway and then with the protection that you want. And then you put you start adding targets and targets could be different microservices, right, one swagger file at a time so you have 5 in this case have 3 swagger files or 3 microservices endpoints. I'm going to be adding 3 targets into it. Um, so it's the, the, the, the information around the cognito and then what is the, uh, uh, role that gateway incident is going to use so it's going to run that, um. The next thing is the identity provider name. So this is, um, uh, passing in to this identity provider, uh, service in agent core as you saw in the slides. There's an agent core identity. So identity, think about it like a helper for the agent to be able to get that token instead of the token having the client secrets like in code or an environment variable and doing doing that token exchange from machine to machine token. Identity can do that for me, um, and it has a nice SDK that your honor is going to show on how the decorator would inject that token, but I need to create the identity right to protect the MCP not protect the cognido is protecting the identity is a service that will handle getting the token for the agent, but it needs to know like where. Do I get it from? Well, you're going to get it from the cognito and requesting it with the proper, uh, scopes. So this is why I'm passing like the, the user URL, the authorization endpoint, the token endpoint. So the identity service is the one that is going to call cognito your, uh, service to get the token back and then. Uh, that, that piece of information, there's some piece of information that I need to, I need to pass to Roland or Roland's team, right? So I need to pass to it the gateway URL. So once you create the gateway, even without target, so that URL you can keep using it. Um, that role I would need that when he creates this agent he needs that MCP URL to use the MCP STK to connect to it, and he's going to show that. And then I need to give it the identity provider name. So in Agent core you will see as you develop multiple agents and MCP gateways you may have different identity providers so you need to select. What is the instance of that provider that we just created in this script and then the resource server ID is the from the cognito when you ask for a scope, for example, for that gateway you get a token that has the right claims like a it's a job token that has the right claims um so let's run that to see if we can get our MCP gateway created. So if I do UV run. I forgot what was the command the, the script, uh, so I have different scripts in here so you can see I have like, uh, test the gateway test the connection, um, oh, we, I'm going to show that in a minute, creating entry bucket to save those JSON files. But let's create the gateway. So we're going to run it once and again then I'm going to run it again with uh. Thing, so in this case it's going to create the cognito. It's going to create the identity service and it's going to create the MCP MCP gateway and get that information stored in SSM parameter for Roland to use. So in this case, um. And we have emojis because Quiro likes to put emojis, uh, on status, uh, which I think is cool, um, so it, yeah, and it actually describes all this all this text output. I, I think I like, um, if I had, I didn't have the time when I put it, but Kiro just put it for me so it's very useful, um. And then this is the gateway that Ron is going to use. So I'm going to give it to it. So let's go to the console uh and see a little bit of this. So this is the aging core, um, landing zone or first page that you see. And on the left, I don't, I think this is good, uh, we could gateways and we have our reinvent app gateway that we just created, um. And it has the MCP. Uh, URL that I'm going to pass to Roland and it has the, the identity, right, the inbound identity using Cognito and discover URL, um, on how it's going to be created. So, so far so good. So let's create the targets to my 3 microservices appointments, technicians, and, um, what's the other one claims yeah claims um so the next piece on this setup is Part B, creating the MCP gateway targets um so you can create the gateway once and they get the the targets. So in this case let me comment out. This code. Here And then I'll run it again. And then this would is the information that it is going to do as this is what I'm going to show the code. I'm going to do appointments with a description customer a technician. Uh, the claims are inside the the customer. So, uh, it's 3 ser 3 services appointments customer and technician and the claim information is stored inside a customer with the policy. Uh, it will go over each of the three targets. It will build the, the URL, remember, of, of the URL that was missing. So I'm going to fetch the JSON file. Um, insert that this URL, uh, in this function, uh, so it's upload and then upload it to an S3 bucket so the MCP gateway, uh, the way it's worked is you have to put this JSO file in the S3 bucket and then give the gateway the S3 location of this file to create the target, um, and then this is the API URL that you're going to hit the, the path and the bucket name and then you create the target. With the credential provider ARN, so, um, what, what is this, this does is if your rest API is protected, which it should be protected most likely it should be, it could be a parameter, uh, or it could be an authorization, right? I like the, sorry, a header like an authorization header, um, the UR the URL to that bucket what I want to call the target a nice description for it and then the gateway ID to which. Gateway should I should I attach this target as I create the target so this code actually runs run 3 times. As you can see here, it ran 3 times. It got the JSON code. Uh, Jason opened his, uh, spec API, inserted the server, put it in 3 bucket, and created the gateway. So, and actually I can show. The S3 bucket. Should be here. Let's see if it's here. Agent Court Gateway. Yeah, so these are the, the 3 JSON files that this code did. It just grabbed that, um, it created, it put the appointment. Jason customer. Jason, technician. Jason, and that's what I passed when I created the target this location of this, uh, Jason files in here. So this is where uh the adjacent is located and then then the the target can be created we grab it and then we expose so if we go to. The Asian gateway. Here at the bottom. Uh, I have my technician, my customer, and my appointment. So, uh, there's not much information, but it says that it's their status. So it takes like, like a minute to be created, uh, the Jason, the, the, the S3 location of that Jason file and an ID. So there's no, no, not much about it. Also the album of details. So this will click and, and go into like how to authenticate to the rest API. Let me see, uh, go back to the code. Um, How we're doing with time? We're good. OK, um. And the other thing I wanted to show, so this the S3 bucket, the gateway, and then, uh, the information I'm passing to Roland, which is the SSM parameters or SSM, I think it's here. Let me open a new screen. Here and then. I think it's parameter store. And I use parameter store because uh it's configuration it's not like a secret if I had a secret uh I will store it in the in secret manager I'll show you in a minute. Uh, secret manager is used, so you have to configure AIM policies because the identity service is using a client token, a, a client secret, and that secret is stored in secret manager. So any time that the identity service needs to do that a token exchange, it will go to secret manager, grab the, the value that is there. Get it and then do the token exchange with Cognito. The same, the same thing happens when the MCP gateway it's going to connect to your RS API if you have like an API key, for example, or like um an authorization header and that, uh, this be configured to access this RS API. It also stores. Cre in in Secret Manager, so the service has an integration. Agent Core has an integration with Secret Manager to do that for you. So it's a convenient way of doing that and also providing the SDKs to trigger it from from the code. So when I run the code, actually this what happened behind the scenes when I created the target and I created the identity, um, so yeah, this is the information that I'm giving Roland. So for example, the most important one is the MCP URL. So as you can see, the value here matches is a gateway. bedrock agents West 2. So we are in West 2 Amazon AWS.com/MCP. So Roland's going to use the MCP client stream streamable HTTP, uh, uh, endpoint to connect to it, uh, with the token when identity gets, gets the token back. So it's one way uh you can have multiple ways of interchanging this this information right if it's something that is already known but uh we did it through code because that will make it more secure to handle the parameter passing and and so on. Uh, so we, I show the S3 bucket we're storing the, the Jason, um, or the secret manager. So I showed you secret manager will have a few pieces because we are also doing the, uh, the inbound, uh, identity service like when somebody wants the UI is going to talk to, um. The UI is going to talk to the agent core. It's not like anything can talk to your agent core. We want to protect that connection, uh, to the agent. So you can see here, uh, this is the information saved as a API key is the API key that is access the, the service and then the reinventcognito here so. Um, I can show this, right? This is the client secrets, and I'm going to delete this, by the way, so it doesn't matter, um. And, and then this is the the client seeker. So if you have automation to rotate this client seeker incognito, right, maybe you, uh, generate a new one, right? It got leaked. Then you can have some automation that actually rotates, goes into cognito, rotates the client secrets for a new one comes back to secret manager, and you can just put it here and then the next time the identity service needs to grab this to exchange. For a cognito token to access the MCP gateway on behalf of the uh of the agent, it will have it there. So the, the automation is there and that's why we provide all these services and all of them have uh APIs and we offer STK so you can use like call build pipeline, the CLI formation terraform or ICK to actually do this rotation. Like some, some companies have some policies, right, uh, customers have some policies. In the organization that they want to rotate maybe like every 90 days or every or every 6 months um rotate rotate that so that's the the integration with um. Secret manager, so you will see that this information if you get the all the details about the uh identity service. So actually I can show that here that it got created. So you can see here, here's the reinvent cognito gateway provider. So that is the provider that my code. Uh, created and this is the information that, uh, is, is, is stored behind the scenes on how to get access to the client secret which is here. I could go here and click on it and it will go there so that's the integration and the security aspect of using uh agent identity. And I think that's it, Roland. I have like this the same parameters for you, OK, OK, let's go. Let me, uh. Remove my things so you don't need this you don't need this you're going to create an agent, um, and then show us the UI we're gonna show the agent, yep. All right, Carlos, thank you so. Over here I'm inside the agent project. I'm more of an AWS native developer, so I use Agent Core runtime, which is serverless. We're using Agent Core Gateway, Agent Core identity, but the UI actually built it with ECS and Fargate, uh, because, you know, he's a Kubernetes guy. I'm not. I'm just an agent developer, and so, but we have a lot of our core highly scalable business logic on the EKS cluster. So, uh, we're gonna over here in the code we're inside my project now, uh, for convenience we put it all in Carlos's laptop, but we did this separately. We have home insurance uh is my agent, so the first thing we did is Carlos show talking about loading the SSM parameters. He already showed them, so this is basically the code to actually go and retrieve the. SSM parameters to get the information I need around um which is basically the gateway provider name, the gateway uh resource server and the MCP URL that he showed so this is just basic code that we use in AWS to kind of go and get my parameters from the SSM stored using the APIs uh in AWS and so we do that. So the next thing we wanna do. Because we wanna show the code around getting the MCP client and getting the authorization token now you know we don't wanna store credentials, make the staple, so we're gonna use a a decorator in Python so that every time we go and we, uh, create the gateway client or we access the gateway client, we wanna be able to get a refresh token. So this is a good pattern to do using a decorator pattern so it's gonna call, uh, the SDK APIs to get the access token. So each time it calls this function you're gonna get and get a refresh token which is a security best practice and so here you see we're gonna get the URL and then we're gonna use the standard uh MCP client SDK to actually create an MCP client using a Python lambda uh uh function and we're creating that using streamable HTTP client because it's a remote. Uh, MCP server that's hosted by the gateway, get the authorization header which is refreshed with the decorator each time, some timeout parameters, etc. So that's the next, uh, step that I do in my code as an agent developer. We have, of course, uh, access to the model. Um, I believe we're using Haiku 4.5, um, from anthropic. And then this is just some cleanup code around um stopping the the the gateway etc. So here we have part C, right? We're gonna create uh the AI agent and we're gonna make it an A2A server. So uh to we're gonna get kind of the headers that we need because we want our agents to be able to access AWS resources like the gateway and identity and we're gonna get, um, your agent core SDK token as well. We're gonna get our session ID as well, so we're gonna have a session. And we're gonna use a little helper called agent context to kind of store the session ID as well um if it's not found so and we're gonna check if we've already gotten the agent since we're using uh agent core runtime if a request comes in and the run time is still up and running, it'll just get the agent again we won't have to refresh goes away it'll, uh, lazily create the agent again. So, uh, over here, uh, we go, we use the. Uh, the agent context, get agent, uh, if it's not there, we actually go ahead and create it. We start the client gateway, uh, we set the client gateway, uh, we get the list of tools, and here we have our strands agent. So we use the strands SDK. We give it the list of gateway tools that we get from the gateway, give it our model, we give it some of our system prompts and a description, and we go ahead and create the strands agent. And then we wrap the strands agent as an A to A server, uh, that way in the future if another agent wants to invoke this agent, uh, that, that's set up and we run that inside of agent core runtime. So let me show you some of. Um, this is the first time I do this on Carlos's machine and so we're gonna go and look at agent core runtime. So we've deployed this, the code to deploy that is there as well, uh, where we have this, uh. Home insurance agent which was deployed version 41 so we deployed this um a few times, uh, so we have an existing running one already you can see we had a two week gap uh I was traveling that week um for a customer visit so we have this running in our runtime. It's a serverless runtime. It does all the things around observability as well prebuilt in so really excited about that. Uh, we also have the UI running in ECS Fargate. I'm gonna run it locally, uh, for the demo here. So I'm gonna go back I move. This back up here and go here. I'm gonna, uh, did I lose it? There we go. I would just hopefully uh. Sorry, I got all of Carlos's history there. All right. Uh, yep, you've run, I, yep, you've run UI. So let's go and run. The UI application. OK. We're good, yeah, local holds, uh, 8000. I think I have it opened up radio. I think the greater one, yep, cool, refresh it to see if it's connected. Demo goats are inside, yeah, Wi Fi demo goats. Alright, clap, everybody clap. Alright, there we go. So I'm gonna say. Uh, let's see, uh, what, uh, get your cap locks up. I don't want what, uh, yeah, like we did have the tools do you have, let's see, so this is the video that you saw at the beginning, like asking like, do you have access to the tools, and they should come back with something about appointments, customer, right? The 3 microservices. Let's see, yep, so there you go. Where is it? The 3 tools, the 3 different microservices, appointment scheduling, technician services, and so, so I'm gonna say. Carlos was. Dancing. Salsa, you have to be specific and. Crashed into the fridge. It's water everywhere. There's still water is everywhere. Um, and buttons don't work, right? Yeah, alright, so this is what happens when Carlos does, uh, salsa dancing. Let's see what what we can get. And you are user Emily I think um I think she has a valid policy. We'll we'll see yes so notice we logged in as I knew it was. I was like perfectly I successfully created your claim with uh 019 claim has been submitted marked as high urgency given water is everywhere. This is definitely a high priority issue. Would you like me to schedule an emergency service appointment repair? Yes, please schedule that. Quickly before Carlos's wife finds out. See what we can get here. So it's going from the UI to the agent to the MCP gateway to the ECAS cluster and back, right, and the LLM in the in the middle, right? The LLM, uh, this information, yeah, my, my agent is sending that to the LLM and this uh, uh, agents have reasoning, right, so it can go multiple times to the LLM to reason about it, uh, with multiple calls, not just one MCP call. Still processing here we go. All right, so an appointment, yeah, so it says perfect. Yeah, I've got you set up appointment time, etc. uh, David Chang, so in 2 hours, December 2nd at 9 p.m., pretty late technician visit, um, let me see what. Can I do about Carlos? What? Why you asking what to do about Carlos? Yeah, like, you know, it's, it's bad, you know, fire him, you know, I don't know. Let's, let's see. Let's don't let him do, uh, salsa. Yeah, don't let him do salsa. Let's see. Oh, and that's, of course I'm Emily in here. I can hear the concerns in your question. While I'm quite skilled at handling refrigerator emergencies, insurance claims, and scheduling repair performance, I'm afraid my expertise doesn't extend to managing Carlos's salsa dancing habits. And tells me repairs that gives me some suggestions from the LLM, a dance instructor you need one. You should get a Cuban like me uncuano unacuana, and then, um, you can maybe get clear more space. Maybe don't dance by your refrigerator. Maybe some dance lessons for you and your wife and maybe some protective padding around your appliances. So some good recommendations for you as well. That's smart, smart. Oh, awesome. And so I think that that's kind of the demo that we have. We showed some of the code. We will be putting this in samples very shortly. Yeah, uh, we have, we have a slide with the QR code that has all the right things. So switch back to so we can PowerPoint and go. Let's see. So you should be back. Yeah, this is the, the demo that that Ron already played. So this was our backup the Wi Fi didn't work. Uh, let me go to the, we did, we didn't, we didn't need the, the, the video which is I'm pretty so what we learn and resources, yeah, so you know, um, we definitely have like the abi like ability to expose your existing systems, your deterministic logic, all that great stuff, use MCP gateway to expose that logic, make sure you have security, make sure your agents are, are, are the only ones that can secure it and act on behalf of the right users and. You know, Agenta can unlock a bunch of modernization for you. Um, we do have, uh, some samples and stuff we'll be doing both on the EKS side and agent core examples, and we'll be posting them and we have some resources here if you wanna take a picture. Now this is where you're going to see the access the the resources that we mentioned and some also useful links and the code, uh, is there, um, yeah, check it out uh it's there and. Some sessions. Tell your friends we're repeating this tomorrow if they wanna see the code, but also RC 3:14. I'm doing, I'm doing that session at 5:30 tomorrow over at the Wynn. That session is gonna be with another colleague of mine named Redula and and she and I will talk a lot about more the architecture considerations and things, um, you know, if, um, you can find us in the expo if you wanna ask questions since this is recorded we'll take questions after we stop recording, um, and then some of the other sessions that the other, those sessions actually the 3:17 is here in Mandalay Bay at 4 p.m. You can meet me again. Uh, we're doing a hands-on workshop on EAS MCP. So if you're like learning about MCP, how to use MCP EAS to troubleshoot your ECS cluster or analyze it or manage and, uh, do DevOps with, uh, with that, yep, and we, I, I'm hosting in uh. Uh, an event for our technical field community and some customers at the Rock house, I think later at 5 or Venetian Rock, yeah, yeah, so if you wanna pass by and ask questions and chat about those things, you'll, you'll find us there as well. So thank you for coming.