---
video_id: yvLmJS-ayyM
video_url: https://www.youtube.com/watch?v=yvLmJS-ayyM
is_generated: False
is_translatable: True
summary: "This session, \"Deep dive into advanced routing policy with AWS Cloud WAN (NET401),\" features AWS leaders Shridhar Kulkarni and Sid Vangala, along with Qi Jun from Airbnb. The talk introduces new routing policy capabilities for AWS Cloud WAN, enabling fine-grained control over route propagation, traffic steering, and path selection. Qi Jun shares Airbnb's success story of migrating their global backbone to Cloud WAN, achieving significant cost savings, rapid deployment, and improved operational efficiency. The session details how to use routing policies for route filtering, summarization, and BGP attribute modification (like local preference and AS path) across attachments, segments, and regions. Detailed demos illustrate use cases such as summarizing VPC CIDRs, filtering overlapping IP ranges, restricting cross-region access for compliance, and isolating hybrid routes using BGP communities. The presentation concludes with best practices for policy directionality and a look at using AI assistants like Amazon Q to generate routing policies."
keywords: AWS Cloud WAN, Routing Policy, BGP, Airbnb, Network Automation, Route Summarization, Route Filtering, Local Preference, Hybrid Connectivity, Global Network
---

Alright. Welcome everyone Let's put our headphones on Um, I hope you guys are having a great time at Reinvent 2025. I'm thrilled here to talk to you about our exciting new release, routing Policy with Airbliss Cloud Van. I'm joined here today by my co-speakers, uh, Q Jun, senior network engineer from Airbnb, and Shridhar, uh, principal product manager, A Blis Cloudw. Now building hybrid connectivity, in fact, network connectivity in general is tough. It's complex, especially when you have multiple on-premises networks which needs to connect to VPCs, not just in one region but in multiple regions. And then you have ever changing application connectivity requirements through which you need to start tweaking things. That's where Airbus cloud one comes in. It acts as the brain of your network, providing robust connectivity to all your networks. Now if you look under the covers. We have core network edges in every region. These are highly available, scalable routing entities, which is where all the magic happens. They let you establish connectivity to your on-premise data centers via it was Direct Connect or site to site VPN. Or SD-BAN connectivity using connect attachments, and it also connects to your existing transit gateways. It enables traffic flow not just on-prem to AWS but also AWS to AWS intra-region as well as interregion. All these traffic flows can be inspected with a single click using AWS Cloud One service insertion feature. Now the great thing about cloud van is everything is dynamic routing, so you don't have to ride any static routes. Routes are getting exchanged dynamically. Now while that's a great thing to have, we know when you have hundreds of VPCs, uh, multiple on-premises networks, route exchange can become complex, and that's where the new routing policy is really powerful. So in today's session we are going to do a very quick recap of Airblis Cloud One. This will be a rapid fire. This is a 400 level session, so we wanna spend most of our time talking about routing policies. Then we'll hear from Airbnb on how they are using Airbliss Cloud One, and then we'll dive into routing policy along with multiple use cases and a bunch of demos. So let's do a rapid fire of what Airbrus cloud one is. In Airbus cloud one, everything is through a policy. So here we define a policy. We give it three locations. When you execute this policy, behind the scenes, 3 CNEs, one in each region, is automatically provisioned and fully meshed. Then you define segments. Segments are fully isolated routing boundaries. Here we define 3 segments production, development, hybrid. Now we take our remote networks including VPCs, transit gateways, whatnot, and attach it to our cloud van, but then we need to associate the right segment for that we need an attachment policy here we're using tags to automatically associate the right attachment to the right segment. And then finally we need to share routes between segments because segments are fully isolated uh by default so to enable sharing we have this share segment action. The next feature of cloud vendor service insertion, which lets you insert network appliances into your traffic path. There are two traffic paths we'll talk about. The first one is inter-segment traffic path. Here we write a policy saying broad segment when traffic is being sent to development, send via a network function group, and here we're using the dual hop mode, which means the traffic is getting inspected at every inspection region in both the VPCs. Now the traffic, both the request and the response is getting inspected. The next traffic path we have is the single hop mode, so broad segment when sent to development sent by a network function group, but as you can see on the bottom with edge overrides. Uh, as traffic is flowing between US East 1 and US West 2, use US East 1, so it deterministically always sends traffic for inspection to the inspection VPC in US East 1. The next we have is for Internet egress traffic. Here the policy says any traffic exiting segment development send to network function group, right? And we also have an edge overrides here which says if my region does not have an inspection VPC, in this case US East 2, always use US East 1. So this edge overrides functionality gives you, gives you that deterministic way in how you set this up. Now I went really fast. I told you it was a rapid fire. So if you wanna learn more on how all of that works, we went into a much more depth last year's reinvent session, um, so you can definitely check that out. So now I wanna hand it over to Qi Jun to come and talk about how Airbnb is using, uh, cloud van. Thank you. Hi everyone, good afternoon, and uh I'm happy to be here to share our experience with AWS Cloud One and I would like to start with a very quick uh story. It's like um over 6 years ago when I first joined Airbnb and uh there was an engineer from another team once asked me why configuring network cannot be as easy as, um, software development. But then, I don't know how to answer. It's like, um, configuring a network. It's, uh, it involves so many different types of devices, and there is no simple and unified way to automate all the configurations. So, um, also the version control for the network change is also very difficult, and, uh, well, but this, this question stuck in my head for quite a long time. And until like 3 years ago, and then when I learned about the AWS cloud one, I think I may find an answer. So, um, I'd like to share with our experience. And for those who don't know me, and my name is Qi Jun. I'm the lead engineer for the Cloud One migration project in Airbnb. So Airbnb is, uh, well, we start, we started from a very simple idea is to like help everyone to find a place to stay, to connect the travelers with all the, uh, hosts all around the world. And over the past years, this simple idea has growth and into a global platform. And today, now we are, we are hosting over 2 billion guests and also Airbnb is a company with 7300 employees. And uh my team, the network engineering team, so we will uh deploy and build a global network to support all the connectivities all around the world. Our goal is to provide a secure and also reliable networks. And uh let's dive into the network parts. So, um, you may see a graph here. It looks very familiar for all the neuroengineer. So, uh, in 2013, that's the time, uh, Airbnb grow so fast, and we have a very, uh, fast increased demand for the audio and video traffic. So we need to design a network and to support the low latency and high reliability. And that's why we build a physical data center network during that time. And in the middle part, there is a physical data center, and that's our backbones. It interconnects all the network components within our networks like the all the services deployed in the AWS cloud 10 sorry, AWS VPCs and also the um our client net uh VPNs and all the offices and many other external networks. This model works great and it provides us a secure and then a reliable network connectivities. And let's fast forward to the 2021. It's the time for our physical data center to approach the end of life. So, uh, it's a great time for our team to step back a little bit and rethink how the, how we can design the network, like what is the next generation network looks like, and more importantly, how can we build a network to support the fast-growing, uh, cloud-based services. So we build an initial proof of concept design, like in this uh simple graph, it's, it, uh, it shows the simple connection with uh about our proof of concept design. So we use the full, uh, full mesh connection for the AWS transit gateways. This design works great. The test works great, but at the same time, we figure out, uh, AWS Cloud One is mature very fast as a product. So we do a evaluation on it and figure out AWS Cloud One is actually an even better fit for our needs. So, the cloud one, they, uh, support the dynamic engineer uh dynamic routings and have a strong automation support. And also one important thing, it has a simpler infrastructure. So here is the graph shows like uh how we use cloud one in our network currently. And in in this graph, like uh cloud one is the middle part, also our backbone, because cloud one is a global platform. And uh it supports the dynamic routings. So we no longer need to use the uh full mesh connectivities, just like the transit gateway solutions, and this solution works great. And also because uh the cloud went in the middle as our um main backbone, and we can use the core network policy to centrally manage all the network components in our network. And uh also you may see the inspection BPC in the bottom part. So the, that is for our layer 7 firewalls. The security is an important component in our network. So, um, our standard approach is to build a layer 7 firewalls to inspect and control all the traffic on our network. And this design works very great in uh with the cloud one. And also I want to mention about is the telephone enterprise support. That is the that is the support enable us to deploy and manage our network all through code. So with the built-in version control and easy roll back for the network change. So that answers the question from 6 years ago. And well, this, um, the migration to cloud one is very successful, and we have already put our production network in cloud one for over 1 year, almost 2 years, and this is the benefits we see. The first one I would like to mention is the cost savings. So, uh, now because we decommissioned all the physical data centers and also the circuits connects them. And we are able to save multi-million dollars every year. And another one is the automation parts. That's something we really like it and uh with the automation, we are able to use the code and then to deploy, manage our whole, our whole network. And it's easier for our network to change because they have the built-inversion control and just have an easy rollback. And that helped us a lot. And uh also another one is the rapid deployment because everything is based on code. We can use a modularized coding and then to spin up a new data center in a new region within 2 days. Compared in the old days before the migration, like uh for the physical data centers, it could take like weeks to months and involve multiple teams' efforts to build a physical data center, and now we can do it within 2 days. And the one thing I also like to mention is the operational efficiency. Uh, after we migrate our network to the AWS Cloud one, we are seeing improved up time. And also, uh, AWS Cloud one, they provide a centralized place for us to do the monitoring, and that helps us a lot. As a network engineer, I used to get paid a lot uh for the network issue, like the network device hardware issue, cabling issues, SFPs and all the stuff, or circuits issue. And after the migration, AWS has helped us to handle all the underlying circuits connectivities. So that frees up our efforts and allow our team to focus more strategic and more impactful tasks instead of the routine maintenance. Yeah, and with all these changes, and it basically transformed our way to deploy and manage our network. And we are really happy and then with the um less routine maintenance effort, but we still ensure a high, um high reliability networks. And what we're currently, we are still working with AWS. To improve, uh, further with our current network. Here is the challenge we're still facing. So one of them is the static routes. We still need to configure some static routes, mostly it's for our firewall inspection because um our environment's requirements. And uh also, our firewall currently, they have to do a double inspection design and which we like to move away. And another thing is like uh we have a lot of requests from our trusted team. They would like to self-manage the routing to cloud one right now. And uh also we would like to have an easier route filtering. And, but the good news is AWS is actively working on it. And now the service insertion features and also the advanced policy routing. And that could potentially fix these challenges. And we are very excited to uh testing and applying these new features and hopefully we will improve the network even further. So to conclude, and then, uh, we, our migration to the cloud one is very successful, and we have uh enjoyed a lot of benefits, as I mentioned, and we are still working on the challenge here and um I will hand over to Shida and then he will talk more about the advanced routing policies. I hope this talk will inspire you and to look into this technology and maybe try it out. Thank you for your time. Thanks. Uh hello everyone. Just a quick intro. My name is Shridhar Kulkarni. I, uh, lead product management here at AWS for a couple connectivity services Cloud Van Transit Gateway and Direct Connect. Um, so great to see you all here and I just wanna take, uh, an opportunity to thank Fion and the Airbnb team. Uh, for putting trust in the cloud one service, I know you were early adopters of the service from multiple years back, and, uh, it's amazing to see you grow your network, uh, with Cloud one as the backbone for that. So thanks for that and also sincerely appreciate, uh, all the feedback that that your team has provided over the years. Uh, it helps us, uh, make our products better. And by the way, that applies to a lot of the folks in, in this audience because I, I have so many familiar faces here. Uh, really, your feedback makes us, uh, you know, come up with better services and better products. So, uh, speaking of making the service better, uh, today I'm excited to talk about a brand new capability that we just launched a couple of weeks ago. It's called routing policy on cloud VA, and it gives you, um, advanced routing capabilities in order to essentially control, uh, propagations within your network, right? It helps you manage your routing much better. And uh essentially it helps you customize your network uh as per your individual needs, OK? So before I get into. The feature itself I'm gonna set the stage a little bit, uh, give you some context in, in terms of like why this feature is so important and why this capabilities is so value driven, right? So, uh, let's look at a typical cloudware network. Uh, let's say 3 regions, uh, obviously there's a CNE per region, and then you have 3 environments proud, uh, dev, and hybrid. Your proud and dev VPCs are attached to, um. Your, uh, proud and dev segments and then your hybrid segment is attached to, uh, it's connected to, let's say like, you know, your external networks, right, your data center that's connected via DX attachment, uh, to the hybrid segment, or you could have remote offices that have site to site VPNs, uh, that are coming in into the hybrid segment, or, um, alternatively you could have SD-WAN based networks, right, so you could use something like a tunnel-less connect attachment. Uh, that's from coming from an its demand appliance and then attach that to, uh, the hybrid segment, right, and all of these attachments that I'm talking about right now are BGP capable attachments, right? So there's propagations, uh, route ad advertisements and learnings, uh, in both directions, uh, dynamically on all these attachments, uh, and then similarly transit gateway peering attachment, right? Let's say you have a A different group or you do an acquisition and they're using transit gateways to attach their VPCs, uh, then you can take the peering connection from the transit gateway and attach it to, you know, the prod or the dev segment using route table attachments so that you can maintain the segmentation into end. So the point being, um, and all these routes are, by the way, propagated not just on these attachments but also across regions, right, like you cloud van. Uh, supports like dynamic routing, uh, as a table sticks feature, right? It automatically propagates all the routes across regions and then same thing across segments like you can share routes across segments, um, and, and routes get propagated. So this is amazing. It's a fully dynamic network and, and you know customers love it, uh, but then, you know, there's some challenges, right, that that that this kind of an environment can, can present to you and. So the number one challenge is uncontrolled route propagations, right? So we have heard from, uh, from you and from customers over the years that, uh, they wanna be able to control route propagations at all these distribution points, right, or the attachments. Uh, across segments or, uh, you know, across regions, uh, and, and, you know, they that could be just to minimize, uh, the blast radius of propagations or whatnot, but you know they need some control in terms of what routes get propagated, uh, globally versus locally, right? The second thing is, uh, indeterministic traffic patterns, right, so. Again, a fully dynamic network multi-pathing is super common from a remote site. You could have multiple paths coming in into the core network, one via SDWAN, the other one via Direct Connect, and then in such a scenario you want the control to sort of do some sort of path preferences, right? You wanna say, oh, for, for these prefixes, I really want them to that traffic to come over SDVAN, right, versus these other prefixes I prefer my direct connect path. Uh, so that level of control, so that, uh, you can have some deterministic traffic patterns through this, uh, dynamic network, that's super important, right? And then route scaling again this is sort of like a derivative effect of the uncontrolled route propagations issue is like let's say if you're connected to a partner network and then you advertise all the routes in your segment to that partner network there's a chance that you're gonna overwhelm the routing limits, uh, right on that router on the other side or vice versa, right? So you wanna be able to sort of control those propagations that, uh, to, to prevent any scaling related issues. And then last but not the least, uh, troubleshooting, it's a super dynamic environment and then you need that advanced visibility into your routing databases to figure out like where you're, you know, learning these routes from and then what are the advanced attributes that are associated, uh, with these routes, right? So these are some of the challenges and this, these are the ones that we have addressed in this brand new routing policy capability we just launched a couple of weeks back. It gives you fine-grained routing controls at each of those distribution points uh that I that I talked about in the previous slide, right? Uh, on the attachments across regions across segments. Uh, optimize traffic patterns, it gives you the ability to, to, um, modify, uh, the advanced BGPR attributes, you know, like local prev or ACE path treats or whatnot on cloud one itself so that you can influence paths coming in, uh, or influence traffic coming in all these different paths, um, so optimizing traffic patterns, preventing asymmetric routing, right, uh, all of that you can control using, using this feature. And then last but not the least visibility right again you get full visibility into the routing database into the rib as you as you say the routing information base, uh, so that you can proactively troubleshoot issues or or you know, ensure that. The way the network is behaving or the way the traffic is flowing is as per, you know, the way you want it that's for your policy. Right? So, uh, let's look at the features, uh, in a little bit more detail. So the, the first, uh, feature that we're offering as part of this capabilities is route filtering. So you will be able to allow or drop routes or prefixes, uh, both in inbound and outbound direction for, uh, all these, uh, different attachment types, you know, the VPN, DX, uh, transit gateway, route table attachments, or connect attachments. Right? Allow or or drop uh prefixes. You can also uh do the same thing on BPC attachments, although BPC attachment is not classical BGP, but it does automatically propagate routes from BPC into the segment route table, right? So you can control that by adding filters, uh, um, in down only filters on that attachment. Uh, you can also control our propagations across segments, uh, or, or filter routes essentially or allow or drop routes across segments, and then same thing between CNE to CNE. You can put filters, uh, on that distribution point, and then, uh, it's the, and I, I'll go into a little bit more detail in subsequent slides, but this is based on the classical match action philosophy, so you can match what prefixes you wanna drop or or the actions that you want to take. Based on certain attributes so you can match here based on prefixes or standard BGP attributes like, you know, Ace uh Ace and numbers or uh BGP communities or or med values, uh, and, and so on and so forth, right. The second important feature is route summarization, right? Again, this goes back to, uh, preventing scaling issues by, you know, advertising all the routes on certain attachments, right? So you will be able to advertise a summary route. Uh, instead of, like, you know, multiple prefixes, right? And then you can do that outbound across all these BGP capable attachments like VPN, uh, DX, or, or connect attachments. And then here again you can match uh based on prefixes. What And then, uh, thirdly, the BGP property modification. So this is where you can manipulate attributes like local preferences, uh, met value, BGP communities, or AS path, right? You can do that again in both directions, inbound and outbound on all the BGP capable attachments. Uh, across segments and regions, and then here we can match based on prefixes or standard BGP attributes, right? So, uh, this is sort of like in a nutshell, uh, what are some of the, you know, the detailed features that we're supporting. With this capability. So let's look at uh how do you get started with this feature or or what does the policy definition look like, right? So there are two high level like two major steps. One is the definition, the defining the routing policy, and then, uh, the second step is taking that routing policy and associating it into one of these distribution points, right? So let's look at step one where you actually define the routing policy. Now, as I said, it's based on the classic match and action sort of a philosophy, so the first thing you do is you define match conditions. Uh, you define your match, uh, thing, and, and you have several match conditions that you can use, uh, like you can match based on a V4 or a V6 prefix. You can match, uh, based on prefix that is part of a cider range, or, you know, match with a prefix list. A lot of our customers, um, use prefixed lists for ease of use rather than having to manage individual prefixes. It's so much more easier to use a prefixed list, which is like a named reference, right? Uh, so you can match based on, on that, you know, your customer defined prefix list, um. You can match based on a sense in the ascent path or PGP communities or met values, right, so there's a lot of flexibility that this capability offers in terms of like what you can match against now. Once you do your match condition, the second thing is, uh, defining the action, right? So for action. We support The classical filtering actions such as you can drop the match prefix or you can allow certain match prefix in the route updates that are coming in or going out. You can do summary routes in uh in the outbound direction. So that's one of the actions you can add or remove ASNs to the ASN path, um, right? So you can prepend ASN list, remove ASN list, replace AN list. You have actions like that. You can add or remove communities, set med values, or, you know, set local preferences. So these are the actions that you can use corresponding to the match actions. Now let's take an example. Let's say you want to your match condition is, uh, prefix equals, which is basically you're matching on an IPV4 or V6 prefix, and your action is you wanna drop that route or you wanna drop that prefix in the, let's say outbound route advertisement, right? So here's how. The policy would look like for that operation, so your policy is essentially um you give it like a unique policy number. Uh, you give a policy name, a unique name like here we're calling it outbound route filter. You give a description and then you give the policy direction. Now this is important. There is a notion of, uh, directionality for routing policies, right? They're either in outbound direction or in inbound direction. So let's take an example. When I say outbound from the perspective of an attachment, like let's say if you have a VPN attachment to a remote site. Outbound is the route propagations that go from the CNE segment route table to your remote site, right? So that's the outbound direction. Inbound is anything that the remote site advertises, uh, and, and to the CNE segment route table. So this policy, what you're saying is its direction is, uh, outbound, which means you're gonna control those routes that are advertised from the CNE. To that remote site Right, so you specify the direction. And then, uh, you specify the rule so every routing policy is essentially a collection of match action rules. So here you're defined a rule, uh, you give a unique rule number and then you give the match condition saying, hey, my prefix equals 190 to 168/16. And then you're saying the action is drop, right? So anything that matches 190 to 168/16 in the outbound direction, drop that. So that's the filter you define uh using this policy. Now, the next step is to associate the policy that you just defined to a distribution point, right? So let's look at distribution points, uh, one at a time. So into segment when you share routes across segments. What you can do is you can reference that routing policy that you just defined in the previous slide into uh this segment action stanza where you're sharing the two segments with each other, right? So here's an example of segment prod that got shared with segment dev and then you are referencing the routing policy here. So any outbound propagations meaning from prod to dev, it's gonna filter out the 190 to 16816 prefix that you defined in the routing policy. Right, so this is giving you that granular control of what routes you want to propagate between across segments and which ones you wanna filter out. Right? So, The next distribution point is between regions. Uh, now here you have, we have a new segment action called associate routing policy. And uh you specify the segment, the source region, destination region, and then again you reference the routing policy, right? So here's an example of how you do that. The new action associate routing policy edge location uh is US East 1. Your peer edge location is US West 2, and then you have an outbound route filter that's, uh, that you're attaching or associating to that those route propagations, right? So this is how you can do cross region. Route propagation control again, you can do it in both outbound and inbound directions. The example here is for outbound, right? Um, And then, uh, the last distribution point is on an attachment. So this is the most interesting one. So this is where we have come up with a new construct called a routing policy label. So at a high level what you do is you take a routing policy. You map it to a label, so your label is just like a tag, right, just like a tag, a label is that identifier. It indirects, it's sort of an indirection for the routing policy. And then what you do is you associate that label. With the attachment, like when you're creating the attachments, right, um, so the routing policy, that's how it gets applied to the CAN cloud van attachments. So let's look at an example for how do you do the policy association association to attachments. Um, so. At the at the bottom there there's an example of creating that label. This is done as part of the attachment routing policy rules, right? So just like you have attachment policy today, that's an existing construct which maps, uh, an attachment to a segment. This is a new construct which is called attachment routing policy rules which matches, uh, you know, to the routing policy to a label. Right, so here you're, you're mapping your outbound out filter policy that you defined in step one. To the label called attachment or filter and then you can call the API, the association API at the top to associate that label with attachment. Right, so this is how you like take a learning policy, map it to a label, and then map that to an attachment, and then that's how you know filters are set on individual attachments. OK. Alright, so, um, the relationship between routing policy and label is many to one. So you, you can have multiple routing policies that you can map to a single label, and then, uh, the relationship between the label and the attachments is one to many. So you can have, you can take the same label, you can make the same, same outbound route filter as an example, uh, where you're attaching, you know, you can associate that with multiple attachments. Right. And then this is the last slide for this section. So this is, uh, speaking to the observability piece. So now you have full visibility, uh, into the rib. You can say for a segment or for an edge location, give me, you know, give me all the routing information, and it's gonna dump the entire routing information base with all the advanced BGP attributes so that you can use that for troubleshooting or for management. Right, so with that I'm gonna hand it over to Sid to go into the advanced uh use cases. Perfect. Uh, thanks, Shriar. So now we all understand how routing policy works. Let's look at some, some use cases and demo. Now this is a demo environment in which I'll be illustrating and configuring routing policies. So I have 3 regions, 3 segments, standard setup. Uh, my proud VPCs are in the 10 range. Db VPCs are in the 172 range. And then to, uh, simulate my on-prem setup, I have SD-WAN connectivity using Tunnelless Connect, and that's advertising 164 routes. All right, so the first scenario we'll look at is route summarization. So what we want to do here is the routes which are being learned from the VPC at the CNE that will get summarized as we send it on-prem. So my 10, 10.1, 10.2 prod VPCs routes will get summarized as 10.0/14. To implement this, step one, we'll create a routing policy to match the VPC cider and summarize them. And then step two, we'll apply the routing policy to the relevant attachments. So let's see how this works. So I have a routing policy summarized broad VPCs. I give it a direction outbound. I'm going to match on a prefixed list like Arida mentioned, it's much easier to manage VPC ciders using prefixed lists, so I have a prefixed list for VPCs which I match on. And then the action is summarized, and I'm summarizing that to 10.014. Now let's apply that So using the attachment route policy rules, I have a condition where I am Associating the art policy to a label. And then we will. Associate the label to the attachment, right? Shridda just talked about how we do this, so we do all of that. OK. So let's see this in action. So I am going to. There you go Yep, there you go. So we go into our console and you can see I have my setup with 3 Airbus regions. I go into my topology tree to just verify my setup as you can see I have Dev and Prod VPCs in US East one, Dev and Prod VPCs in US one, and then I have my hybrid attachment. This is my connect attachment with my connect peers, and I can see BGP is up. Everything's running fine. Awesome. So I go back into my core network. I choose my latest policy. Um, I'll edit the Jason. Now you can see my policy is pretty standard, just defining the edge location segments. There's no routing policies in there. And I'll go ahead and add the routing policies. So let's jump back into our presentation and I'll exactly copy the same. Um, syntax into my policy. Let's go back and take the attachment route policy rules and add that in as well. Now I am butchering the Jason formatting here, but it's OK. It works. That's all that matters. So let's go ahead and that now is pending generation. So you can go into my prefix associations and you can see I've already associated broad VPC's prefix list with Aerobblis cloud one. So that's a step in which you need to do. If I look at my prefix list, you can see I already have 100, 101, 102 siders in my prefix list, so everything looks good. I go into my attachment and this is my connect attachment. And here you can see routing policy label new, so I click that and you can see I've already associated the connect label with my attachment. So that step already done. So now if we go back, uh, this is my, uh, SDWAN appliance, and I can check what routes I'm receiving. So you can see I'm receiving 10, 10.1, 10.2. So the summarization has not happened yet. So for summarization to work and I can also see the exact ASN and the path. So this is all, uh, like the CNE, uh, ASNs. So we go back into the policy and we go ahead and execute it. Uh, if you apply chain set. I'm sure you guys have done this 100 times and we wait for the policy to get executed. And that should happen. There you go. And now we'll run the show IPPGP summary and you can see now I have the summary route 100/14 and the previous routes 101, 102, 100 are gone. Right, so this, uh, this our summarizations working and you can see the, the route path is just, uh, my CNE which I'm directly attached to. So just to summarize what happened here, oops. Individual prefixes were suppressed. Only the summary route was advertised, and the non-specified prefixes, that was my 172 routes, still continue to advise advertise as normal. So, uh, the summary route is created upon the first match. It's advertised dynamically, so it's, uh, uh, uh, you know, coming to GBGP, and it is retracted once all the matching prefixes are removed. The summary route is treated as a new route, right, so it's originated by the CNE and we saw in the demo that uh 100/14, the next hub was the CNE. So any, uh, other ASNs or any other BGPA metrics behind, uh, that CNE is all removed. It's not carried forward. Now let's talk about route summarization policy strategy. So what we did here was global summarization. So all the pro BPCs across the regions, I created one summary route and advertised it down, uh, to my SDAA plans. I don't recommend this for direct connect attachments, uh, because that's a global attachment and it can lead to non-optimal routing. Let's see how. So let's say I have the same setup and I'm advertising, uh, 10.0/8 down to my direct connect gateway and my on-premises, uh, server wants to talk to, let's say 10.1/16. So the traffic goes torn gateway. Now Directonnect Gateway sees two equal routes, one from CNE1, 1 from CNE2, both advertising 10/8. All the BGP attributes are the same. What route will transit gateway take, uh, sorry, reckon a gateway take? I don't know, it might just go to see any two and then see any two senses to see any one. So that's not an optimal routing, right? So don't do this. So what you can do, and, and the same thing applies if you're using IPsec VPN and your on-prem router sees two equal routes from the IPEC tunnels, uh, to the two different CNEs. So what you would rather do is per region summarization, so you have different summary routes per region. So you can see here it's 10.0/17 and 10128/17, so two different routes. And you can also go a step ahead and do per region per segment summarization so you can see here I have different routes for prod for development in region one and region 2. Or you can do everything, right? So for direct connect you can do per region, uh, per segment summarization, and for, uh, attachments like tunnel less connect where it would make sense you can have the global summarization, right? So you can control, mix and match. OK, so our next scenario is to restrict overlapping BPC cider. So let's say you have your SD-WAN set up, you're connecting to remote offices, you make a new office acquisition, and it has 170 to 16 range. Oh no, that overlaps with our VPC in US West too. What do we do? One of the, uh, one of the great things about VPCs is that you can add a secondary cider. So we add a non-overlapping secondary cider, and now the logic we want to implement is that the primary and the secondary cider is learned, uh, by the CNE, but only the non-overlapping secondary cider is advertised on-prem. So how do we do that? There are multiple ways to achieve this. Option one is to apply inbound route filter on the VPC attachment directly. So if we do that, the primary cider is not even inserted into the dev segment. Now you may not want that. You want the other dev VPCs or other VPCs to talk to the primary sider. So second option is let's apply that in the segment sharing. So here the route is inserted into the dev segment but does not make it to the hybrid segment. But you may have other hybrid networks like Direct Connect or site to site VPN which may want to access the primary cider. So what can we do? So we can also do option 3, which is apply outbound roid filter on the connect attachment. So the route makes it to the dev and the hybrid segment, but not to that specific attachment. So for our demo we'll go with option 2. So here is our policy. Pretty strander. I think you're seeing a policy to uh filter prefixes and drop it for the 3rd time. So you guys probably are experts now so we match on the primary cider and drop it. And this is how we apply it to our segment sharing. So in my share depth to hybrid, I associate the routing policy. OK, so let's see this in action. So what I'll do is, uh, I'll copy this exact policy, right, because I'm going to apply it. Uh, but before we do so, Let's look at our deb VPC. So I've already added the second reciter, 172, 172, 1720. So that's already done. Great. We can go into our route table. For hybrid US East one and we can see I'm currently getting the primary VPC cider, the 17 to 16, and I can also verify the same on my SDWAN appliance 1016, so I'm getting the primary cider. So the primary cider is getting advertised and I need to filter it out. So I go into my policy, I edit my policy, go to Jason. And I will go ahead and So in my routing policies, I'll add the new routing policy, which is dev to hybrid route filter. Perfect. And then the routing policy. Reference will be added to my segment share. So let's go ahead and do that in the segment actions dev shared with hybrid. I'll go ahead and add that. And I create my policy. All right, it's ready to execute. Let's uh view and apply chain set. Looks good. Apply executing execution complete. Perfect. So when we go back into ISD one appliance and now do uh show IPPGP and perfect. So now you can see. Our primary cider is no longer uh being advertised. We can also verify that under routes if we go into our. Hybrid segment we should not see that route anymore 170 to 16 so you can see there's no 17 to 16 in that list, but if we go into the dev segment, there should be the 17 to 16 right there, right? So you can see it advertised into dev, but it's not advertised into hybrid and to our SDWA plans. OK, so that filter is working. Next, let's talk about a scenario where in the European region you have a VPC, uh, but due to some European regulations, you don't want that VPC to be accessed by the VPCs in, uh, in US, right? So you don't want that route to be advertised. So, the restricted BPC cider is learned by the CNE. But as it's advertised cross region to the other CNA, we will filter that BPC cider. So we'll create an outbound route filter to drop the VPC cider, and we'll apply that at the segment level cross region sharing. All right, so this is my policy. Filter EU to US. I match on a prefix, so prefix equals 10010.200/16, and I'm gonna drop it. Now the important thing is where I apply it. So Shrida talked about there's a new segment action. Associate routing policy. So I'll use that. I'll define my segment, which is broad. I referenced the filter EU to US policy, and I define my edge locations. So I'll apply it as the traffic is being sent or the routes are being sent from EU West one to US East one, and I'll do the same. When it's sent from EU West 1 to US West 2, right? So the interregion pairs get defined. OK, so let's see this in action. So we go into our policy and now instead of using uh Jason, I'm going to actually use the visual editor. I've already gone ahead and created the FILTEEU to US routing policy. As you can see, preface equals 10, 2.16. I'm dropping it. So now I'll go into segment actions. You can see edge location route policy association, that's a new thing which we've added. You can click associate, you can choose the segment proud. EU West one to US East one apply the policy filter EU to US. Now I'll just do it for EU to US East, not for US West yet. So let's go ahead and apply chain set. So I'm only blocking traffic from EU to not traffic, but the routes propagation from EU to US East one. So if you go to our routes broad US East one search routes. You can see I'm still seeing the 10.2 route, so that's not getting filtered. To dive deeper, I can go into my rib. Get routing information and you can see the 10.2 route is actually coming from US West 2 and I can look at the AS path and I can see, OK, so 6515 is US West 2 and 6514 is EU West 1. So this 10.2 route is getting filtered from EU but I'm seeing it from US West 2. So what I need to do is go into uh my uh Edge associate routing policy and now I need to block EU West 1 to US West 2 as well. And once I do that, now hopefully my US East one will not see the EUVPC routes come in uh either from EU or from US West. So to verify that, we jump into our routes. Fraud US East one search routes. And you can see 10.2 route is no longer present. And we can also verify on US West 2 and 10.2 is no longer present, right, so this should give you an example of how you apply filter to cross region route sharing for a given segment. All right, so my next scenario is hybrid route isolation. So from my on-premises SD-WAN appliances, I've been advertising two routes, 106,410 and 106,420. Now in my on-prem environment, 1064 is for production. Environment and 1061064 10 is for production environment and 106,420 is for development environment. So what I want to do is as that routes are being advertised from on-prem and shared from hybrid to production and development, I only want to advertise 1064 10 into production and 106,420 into development. Now when you do route sharing between segments, it's all or nothing. Right, so when I do hybrid to proud and hybrid to developments, uh, route sharing, both 6410 and 6420 will get advertised, but I want to restrict that. So the way I'll do it in this example is I'll tag those routes with different communities. I'll do that on prem and in my case I'll do that on the SDA appliance. And then I'll create, so you see, the communities are getting added. And I'll create a route policy where I'll match and allow based on that community tag. So I'll have two different route policies, one to match hybrid community and one to for dev and one to match hybrid community for fraud. And then I'll apply those communities as I'm sharing the routes between hybrid and production and hybrid and development. So let's see how we can implement step 2.1 and step 2.2. All right, step 2.1, this is how my policy looks like match hybrid community dev. Direction is inbound. Again, always the direction is very important. Here we are going to match on a community. Community in 65,200. Allow, so any routes which are tagged with that community are allowed. And whenever you're doing an allow, you have to do an explicit deny. So here then we're putting an explicit deny saying deny everything else. I do the exact same thing for prod match hybrid community proud. I match on 65,100 and then allow. And then I put explicit denial in there. OK, so now step 3, we need to apply those policies in the right place, right distribution point. So here segment dev when it is shared with hybrid I associate the policy. Now remember we need to filter the routes as advertised from hybrid to dev, but here I'm saying dev share with hybrid. That's why the direction becomes very important. Remember the policy direction it was inbound, right? But if you have said that to outbound this would not work. So the direction and how you're uh doing the segment share is really important. And then I do the same thing for prod to hybrid segment and I associate the match hybrid community prod. And hopefully this works. Let's see. So, uh, this is my SD-WAN appliance. As you can see, I've configured some route maps to tag, uh, the ciders with pre, uh, communities, and I'm advertising that to my, uh, cloud one peers. I can also verify that by going to the rib into my hybrid US West too, and you can see the communities listed on the right. These are my cloud one peers. BGP and on the right is the community, so I can see those communities come in. When I go to Prague, I can see both 100 and 200 communities when I go to Dev. Same, I can see both 100 and 200, right? But the logic is 100 should be only in fraud and 200 should only be in debt. So I'll go ahead and here. We'll create a routing policy using the visual editor. Match hybrid community dev. We go ahead and Add a rule, Where we will allow. Routes which have this community tag 65,200 and then we also have to add an explicit deny so 200 drop. Prefix inside 000. Perfect. So this is how you can do that. Now if you're going to click Jason. What we configured shows up as the JSON syntax as well, so it's a great idea for you to use the visual editor to make changes and then you can go into the JSON and you know look at how it's done. So for the rest of the stuff I'll quickly speed up. I'll copy everything from my slides into my routing policy. I'll not make you sit through all of that copy paste. So that's all done. I execute my policy. It's getting executed. So what you saw in the slides is what is getting implemented exactly. So let's go back into our core network and now when we go into our rib. And for proud US East one. You can see I only see 65,000 community routes and for deaf, I only see 65,200 community routes, right? So we were able to successfully filter route distribution into our segments based on community tags. All right, so my final scenario here is where I have 2 different regions with my SD-WAN appliances. Now both are advertising the same routes, 6000, 6420 with that community tag. I spin up a new Aeroblis region US East 2, which does not have on-prem connectivity. So when a VPC in US East 2 has to talk to an on-premises IP. It needs to go via CNE1 or CNE 2. Right, so what do you think? Which CNE will it choose? Will CNE 3 send traffic to CNE 2, or will it send traffic to CNE1, right? Let's see. So we are going to go. Into my console where everything is configured, I go into Dev in US East 2. And here I can also uh add additional filter only show me routes with community 65,200. And you can see US East 2 is receiving that uh prefix from three regions US East 1, US West 2, and EU West 1. And you can also look at the AS path to see exactly, so 66556 is my on-prem SDA 655 is my on SDA. Great. Now if I go to my routing table, you can see the CNE decided to choose US East 1 as the next hop and ignore EU and US West 2. Now, I want to change that. Right, so what I wanna do is I have for dev traffic originating in US East One. I want to make US West 2 as the preferred hop, right? So my US West 2 has to be primary for dev traffic. So I want to change what cloud One decided for me. And for my fraud traffic, I want to continue using US East one. So the way I do it is the routes I receive from US West 2, I'll tag them with high local preference, and the route I receive from US East 1, I'll tag them with low local preference. So here's my policy, set high local preference SD van routes. I match on the community and I set low local preference, so this is high local preference. And then my second policy to match the same routes, and I set low local preference, right? Two different policies, setting the local preferences. Now it's important where I apply what. So for my dev. Segment, I will apply the low local preference for my edge locations US East 1 to US East 2. And I'll apply the high local preference for my edge pair US West 2 to US East one. So the routes coming from US West 2 will get the high local preference. So you saw how we do this through the CLI, uh, through the JSON. You saw how I do this through, uh, the visual editor. Let's do it through AI, right? The Gokiro. So I'm gonna take this my prompt. I'm gonna tell it to look into my Aerob Bliss cloud one configuration and, uh, you know, implement this kind of a logic. So I take my prompt, put it into Quiro, and let Kiiro do all the work for me. So now Kiiro is going to first call a bunch of CLI commands, look into my turban configuration, uh, understand my existing policy. Then I also asked it to look at uh Airbus documentation to understand the route uh route policy features. So it's now calling an MCP tool Airbus documentation. It read it. It says perfect. I understand the route preference feature. Then it goes ahead and starts creating a policy, so you can see it's creating the policy. And it has now created the policy. The change it's created a change uh highlighted document so I can see what exactly it wants to add. I can verify it everything looks good, very similar to what I had in my slides, so I'll, uh, you know, accept that and I'll say let's go ahead and. Apply this policy. So when I do that, Quiro will again start, uh, do the apply chain set and go execute uh this policy so. It takes a couple of steps that's done, we can go check our policy version. We can see execution has succeeded. Now when we go into Our routes In depth US East too You can see now 106,420. The next stop is US West 2, so we changed it from US East 1 to US West 2 using local preferences and just to verify, Prod US East 2 is still using US East 1. So I put all my prod traffic via US East 1 and my dev traffic via US West 2 using cross region local preferences. Awesome. Now when, uh, Cloud One has to make this routing decision, it follows a route evaluation logic, right? So most specific routes always wins, but if they're route with same destination, different targets, static routes always win, then BP's propagated routes, and then it looks at dynamic route, uh, you know, so it, it looks at local preference first, which was our case, and then other metrics. And if all the BGP attributes are the same, then direct connect is preferred, then cloud van, then side to side VPN, then transit gate VPing, and if everything is same, then it uses a deterministic random uh approach. All right, some key considerations before we wrap up. Um, it requires you to use a new policy version 2 to 2025.11. Uh, CNE will transitively pass all BGB communities across all attachments. This is great, but it wasn't the case before, so it's good for you to know. The rib presents routes before routing policies are applied on the local CNE. Routing policy direction is really important and it's really directional. When you're associating preface lists with a CNE must be unique. Some applicability considerations BGB community match and modification are not supported on DX and transitive appearing attachments. You cannot replace or remove ASN specified in your CNE configuration. Replace ASN is not supported cross region. Route policies are not supported for network function group service insertion. So if you're using service insertion, continue to use it, um, and service insertion is leverages static routes behind the scenes. So that always takes priority over what you do with BGP. All right, so just to recap, route filtering, route summarization, BGP route property modification, it opens up a huge world of possibilities. I showed you some examples, but we are really excited to see how you use all of these capabilities to modify your networks and and do crazy stuff in the world of routing. Now with that we would like to thank you for coming. Now I know you all are going to uh open the session app and give us 5 star CSAT review. Only because of that I put a tiny URL here, a QR code. If you scan this, you will get access to my entire policy, uh, which I had, uh, shown in my presentation, and that's a real policy which works so you can use the syntax and modify it for your use cases with that we are at time. Uh, from Shridhar, uh, Chijun, and I, thank you so much for coming and joining us and have a great reinvent.
