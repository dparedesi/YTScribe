---
video_id: _nOKPOTJqko
video_url: https://www.youtube.com/watch?v=_nOKPOTJqko
is_generated: False
is_translatable: True
---

OK. Perfect. So let's get started. So network operations at the scale has 3 major challenges uh manual processes that don't scale, inconsistent deployments that create security risks, and validation that uh happens too late. Uh, in the session today we're going to try to solve these challenges applying the same principles. Um, majority of your developer teams, or if you're developers, you're already doing in your, uh, in your own teams, which is automation testing and policy driven deployment. Uh, welcome everybody. This is NET 323 Networks, uh, at the scale and how to automate operations. My name is Paolo Sanchez. I'm a senior network specialist solutions architect at AWS and with me I have Claudia. Hi everyone, I'm Claudia Squierdo. I'm a senior solutions architect here at AWS. Perfect. So, uh, what's the agenda today? Uh, who, which one of you knows what a code talk is? Raise your hand. So not so many people. OK, perfect. So, uh, the agenda today is going to be intensive in coding, uh, solutions, so we will try to be here speaking less amount of time and just more interacting with you while we build something, uh, but first of all we wanted to kind of expand on these scaling challenges, uh, in AWS networking. What are the best practices for this automated network operations that we have seen in customers. Uh, we will explain briefly the use case that we're going to, uh, use as an example today and then of course time to code and then a little bit of, uh, takeaways, uh, for the session we're going to be talking about all of the things so which things we want you to take, uh, after the session today. So, uh, about these challenges, so let me start kind of painting a picture that maybe the majority of you kind of, uh, can relate. So a company starts small, uh, small number of BPCs just connect between them a couple of accounts and that it's easy to get full control uh to know exactly how things connect what's the security of this application, and of course like make sure that everything is documented and it's working perfectly. But then growth happens new VPCs come in, new accounts, um, mergers can happen and then suddenly it's not a natural growth it can be exponential, um, and those tight controls or or those controls initially for these small environments can be called, uh, a bottleneck for a specific teams. So usually, uh, cloud networking teams are not that big, uh, teams, uh, in comparison to the amount of resources that. Um, uh, you guys need to manage, um, and then applications team they're asking them to be agile, but then they need to start waiting time to get some approvals and to get some routes done or some specific security controls in place, uh, and of course these teams because they want to be agile, they are, well, let's say that they're well intentioned, hopefully a majority of the time, yes, um, they open a port, they open a security group a little bit more open that we, uh, would like to have to get that connectivity, uh, happening. And now we have configuration drifts, uh, and now we have configuration that we don't know what's happening with them and of course like when we need to troubleshoot or when we need to know exactly what's happening with our environment we're not really sure on what's happening. So kind of that's what we see that um when we grow we get these three main things this consistency and governance issues, manual configuration bottlenecks, and especially change management um we always tell like the cloud allows you to be agile but then of course usually think we think like the network is something fixed and that shouldn't be like that. The uh the cloud network should also allow for change management without adding extra complexity uh into that. So to face these 3 challenges that Pablo just mentioned, we are starting to face one. Adopt the to work with mana a multi-count environment and this multi-account environment also comes with guardrails. So working with guardrails helps you to focus on permission control for the security of your architecture instead of only networking blocking and with this you can improve how to manage the security of your architecture and with that your network in AWS. And also to make this easier for everyone. And second is to use manage AWS network services that we have here at AWS, but more specifically the service to build global networks. So like Pablo mentioned, the task for all these network engineers like creating Amazon BPCs. Creating a WS side to side VPN, creating a routing table, adding routes, deleting link routes. All of these different tasks can be optimized and help all these network engineers working with these global networks and then go server-less, use the different serveless services that we have. At AWS so you can deploy and automate this many different tasks that not only the network engineers have to do but also the many requests that may be having for the many different users that are asking for help from these network engineers. So how does this look at AWS? First one, to start using AWS organizations. AWS organization is the service that we have in at AWS where. You can deploy uh multi-counts environments architectures and also add guard rails which are named service control policies. So first start with AWS organizations but then work with AWS cloud one. AWS Cloud one it's a service to build global networks, but not only building global networks, to build global networks with policy as code. So in this session you're going to learn how to build these policies. So the idea here is to Know a little bit more about AWS cloud one and AWS step functions. Step functions is going to help you to. Uh, automate the different steps that are required to build the things that the networking engineers need help, but orchestrating those different steps that are required for this. To happen and to help everyone in everything. Perfect. So what's the use case we're going to try to, uh, use today to show you these best practices. So basically we have an environment with where the IP address management we want to be controlled by VPC IPA. We want to make sure that teams don't, uh, create VPCs with IPs that are not into the IPA pool that we're going to provide to them. We need traffic segmentation. The logic we're using today is, uh, we want to have a rotting domain per, uh, environment. Uh, the fraud, uh, whatever, uh, rotten environment, uh, we have, we're going to keep it simple for today, but we want to have that traffic segmentation, uh, also in our network. We want to have traffic inspection. We want to make sure that everything is inspected, uh, between routing domains and anything that goes out to the Internet. And of course, uh, it needs to be uh low in operational overhead because we only have 2 engineers and 2 people that you see right now here talking to you only managing all that, uh, network at the scale. So what we have already built and then I'll go to what we're going to be building today. So this is the organizations we have. We're keeping it simple, uh, but definitely think of more than one organizational unit but we have 3 accounts. We have the account that is going to be managing 8 of these organizations, one account. Uh, networking account in the networking organizational unit and the spoke account in the deaf organizational unit in the networking accounts we have defined Amazon VPC IPA, uh, with the root pool 10/8, and then to each one of the regions we are defining a pool for the deaf environment that we are sharing using, uh, AWS Resource Access Manager RAM with that specific spoke account. So the spoke account can only use the IPA pools we are sharing. On the network level, AWS cloud one, we have an initial version of the network and we're going to be building more during the session today. Uh, we have, uh, a hybrid segment and a dev segment. I think we also have a prop segment, so we have like some segmentation already created and we have, um, for the ones that don't know, uh, we have service insertion. We will explain later in a moment, but that's our way in cloud one to. Um, automate the creation of inspection, uh, by just simply telling the service, hey, I want to inspect these two or these two segments or, uh, between a segment or things outside of the to the internet, um, but we have already created that inspection segment which is called an enter function group and our three inspection VPCs with AWS network firewall, um, already created them, so we are just going to be creating the inspection itself. And of course AWS, uh AWS Cloudon is created by AWS, uh, is shared using Resource Success Manager, uh, with the rest of the, uh, accounts. But Pablo, don't you think that everyone is here to learn a little bit of coding? Yeah, so we're going to be coding. I think we took 10 minutes, which is exactly the time we were thinking about. So let's go into with the different requirements. Uh, let's go with the first requirement which is BBC IPAM as only AP allocation source. So what are we going to do? First, we're going to show that by default I can create noncompliant BBC's, uh, just to show that. Uh, how that by default, yes, someone can create something outside of the PPC IPAN. Once we do that, what we're going to do is create a service control policy that only allows creation of PPCs with the IPA pools shared with the accounts. We're going to do the same creation and we're going to get it denied. And afterwards, we're going to be starting creating the different uh VPCs. So, let me change to the demo and let's go for it. Thanks, Pablo. So I'll be walking around here. So if you have questions, please let me know. Remember this is an interactive session so the idea is to hear from you too. So Paulo can let you know what are you coding, what type of coding it is? Why are you, why are you using Quiro? Yes, so, well, first of all, I'm, I'm, I'm using Quiro. If you don't know, it's is our IDE, uh, that also allows us to use, uh, G AI agents. Uh, we're not going to be doing the help of AI agents today. It's going to be Pablo AI. Uh, but, um, but then what I'm using is, uh, VPC Terraform module. Uh, we're going to be coding everything today in Terraform. VPC module created by us, uh, that are maintained by, by us, by, by the networking team in, in AWS, uh, just to create, where I'm going to start creating that non-compliant VPC, and then I'm going to move to, um, put the SCP in AWS organizations. Thank you Pablo. So the idea here is that we are just getting started. This is IPA IPA is as Pablo mentioned. Uh, is trying to stop someone to deploying, uh, IPRS that it's not allowed and why it's not allowed because Paulo and I as the networking architects and engineers decided that that's the pool that everyone has to use or it's divided by the different segments that. It's based on the best practices that he and I just decide. So the idea here is to work with IPA to use that pool that Pablo and I decide, but service controls policy from AWS organization, it's going to help us. So no one is going to deploy a network that it's not allowed. So back to you, Paulo. Yeah, so basically right now I'm creating that VPC, uh, so I'm coming here I think I'm creating North Virginia. Um, so basically now I guess you see now better, right? Uh, so now we have the mode BBC that is not complying at all because we are going to be using the 10 slash 8 and we have the 172, um, uh, range. So now I'm going to add AWS, uh, DSCP to block that specific action to happen. Let me start by destroying this. And then I'll move to the part of the code for AWS um and yes and then I'll remove this. Perfect. So, if I move to my organization's folder, uh, I already have defined VSCP and the only thing I'm going to do is going to create the resources to deploy in my organization's account. Basically what I'm doing is denying any creation of a VPC and also association of a secondary cyberblock. I don't want anyone cheating after they created the VPC with the IPA pool. So I'll denying these two actions if there's no uh IPV4 IPA pool true. And also because we're controlling which IPA pool we're providing to the dev account we're controlling that is the specific IPA pool that they can that they can build. So, I'll create the two resources right now. Thank you Paulo. So who from the audience it's working with IPA? OK, and who is working with Adules Claan? Great. I love that. So the thing here is to let that only Pablo and I as the network specialist to decide. What IPRs can be used by many of the other part of our team because you know Slash 24, it's not for all the Amazon BPCs and for the all the subnets. So if anyone has a question, please raise your hand and I will reach to you to see what question do you have. So Pablo, back to you. I'm still finishing, so, OK. I don't think I can type and speak at the same time. Don't worry. So my, my question is, how can you share? Maybe you need to ram share a specific seg segment to a specific account. OK, so I wanna know, for example, if I have a situation where I dynamically create accounts. I wanna make sure that specific. Ciders or segments go to specific accounts. OK, so the question that what's your name? Miguel just asked is how can you make that an IPR to be attached or go with a specific uh segment like for example the or production. Um, Paulo, have you done that before? Uh, yeah, give me a moment. I'm just troubleshooting. Don't worry. My Uh, yeah, thank you very much. Definitely I needed an AI for this. Um, so, uh, what was exactly the question? How can you make an IP artist to go for a specific segment like this is for depth, this is for prod, and things like that. So you need to apply that logic more the, the way you share the iPad pools, uh, currently. So you create your iPod pools and then like you do like when you are doing your infrastructure as code when you do RAM to a specific OU where it's dev or a test or production. In the case that they have. Accounts be dynamically created. I'll have to have some, yeah, OK, so that that majority of customers use control tower that you can use for cloud formation or for terraform where you can do your. You can do your account factory where you can say hey this account is dev, then this is the iPhone pool and then of course this is your cloud one or transit gateway. You do that when you create that account you create your blueprint and then when you do that dynamically, you just provide those kind of shared services in the beginning. Would I need to have a specific account to run the uh, I think yes, and I'm not sure, uh, but definitely yes, you will need one account that is the one managing the account factory. And then push into the rest of the accounts. Yes, best in best practices, it should be one main account to, to push everything from the other accounts in AWS organization and in AWS control tower. Mhm, yeah. Perfect. So I already have the service control policy. You can see here I have the same Jason I shared you but now created with our target or de account. So um I think I removed that. Let me see if I can put it back, yeah. So now I'm going to try to create it again and see that now I won't, I shouldn't be able to create that specific um VPC. So Paulo, we have another question. Why are we using terraform and not cloud formation? Mm, that's a personal, uh, decision. It's just like for me it's, uh, more native to, to, to write terraform than cloud formation, but, uh, uh, it, that's, that's for me, yeah, yeah, all the resources. Yeah, yeah, all the resources that we are creating today, they're available in cloud formation. Uh, also, if you use CDK, we have layer two constructs for, uh, layer three also for this AWS networking services, yeah. Yeah, so I, I think I need a clear, but um, now if I do the apply I should get denied on the service control policy. So now what I'm going to do is I'm going to start typing our proper VPC configuration with the VPC uh IPApo uh configure. What's the question? Is it possible to write? The policy without mentioning. The IPA pool, so basically you just mentioned. Uh, less a. So as long as your ABC gets a size of the classic range. So it's like hard code the IP. OK. So the question in here is that if we can use IPA and go to hard code the The IP addresses in the coding per se so it's possible but in here like the thing is that with IPA you are not like hard coding you are learning to IPA to take advantage of IPA it's not only to like give you IP addresses is going to help you to keep control of your IP addresses. So for example if you are close to. Not having enough IP addresses pretty soon it will let you know like if you are not going to have enough IP addresses soon and also it helps you as Paulo just said to like have a design and how you want to distribute your IP addresses so I think that it helps more to have iPad so you can more than just like. Stop people for not using the IPRS that you would like to also have control and monitoring the addresses, the IP addresses, yeah, but for situations where you don't use IPP or you use a different, yeah. So back to you Pablo. Yes, so now I have the version of the VPC created. So you see that the way we're doing this is just defining the VPC IPA pool. The net mass length in that case is 24. Then we also are creating dual stack VPC. So also with, uh, with IPV6. I'm cheating a little bit, just doing a classic copy paste and change the region. Um, you see that we're using North Virginia, Oregon, and the, uh, Spanish region. Um, just to show you like a, a multi-region. Uh, solution, but yeah, and, and here what I'm doing is I have my, I have some local variable where I'm obtaining the IPA pulls from AWS, uh, from AWS RAM and just putting it in a local value just to gather which is the IPA ID per each specific, uh, region. So I won't, um, create the VPCs now. I will do it everything at the end so you see how everything will connect to cloud and and all the automation it's running. So, now we are, we were able to show, let me come back to these slides for a moment, um, to show exactly this, how, uh, our first requirement has been met. So now our VPCs are compliant in that sense and they are able to get the pull from IPA and not being hardcoded. So I think we can move to the second requirement which is an an easy to build global network. And for that we have AWS cloud one, but what we need to do there? We need to do all this, have inspection between, uh, routing domains, egress inspection also between regions. If I have traffic between regions, I don't want to inspect in both regions. I only want to inspecting one. And then the one in orange is the region I want to inspect for every pair of regions that I have. And also I want to do something quite cool in Cloudbo, which is, uh, I want to automate how the attachments get associated to the routing domain automatically. So basically the logic I want to apply is that VPC attachments are associated to their OEU routing domain. And anything that is hybrid, so VPNs connect attachments, so to integrate SD one networks and direct connects are associated to the hybrid segment. So that's what I'm going to be doing now, um, and using policy as code in, uh, in, uh, in cloud one. Perfect. So something really important that you're going to see now that Pablo's going to code that part it's that he's going to work with something that it's sent to and sent via. It's like the main part of the coding with AWS cloud one sent to it's used when you want to. Know what the network traffic is going to end, is sent via is when you want the network traffic to, before reaching the end to pass in a mid mid part before going into the final destination. So for example, send to is like hey it's going to uh the final destination it's on premises or the internet and send via is hey but before reaching the final destination. go through this part and usually as the architecture that we are working in here it's uh AWS network firewall and inspection Amazon BPC or a third party solution for security. So the, for example, you have an Amazon BPC that wants to reach the internet and it's like, OK, send to internet but send via to a WS network firewall or send to Amazon BPC but send via a WS network firewall. So you can deploy the. The finish or the end of the network traffic, but also the mid part before reaching that final destination. So back to you, Paulo. Yeah, so, um, give me a moment, uh, so I don't lose. Um, what I'm doing. So you see that I'm doing something weird that is kind of this dynamic block. So, if you have not worked with with Terraform, this is just a way for me to create dynamically different blocks. Um, Cloud one uses JSON, but in Terraform to make it more easy to build, we use, uh, what we call a data source that we do it in this specific blocks that then get translated to JSO. And um um and then like because I need to create the edge override which is the way I'm telling cloud one between two regions what is the region I want to use what I did is define that logic outside of the policy document definition kind of like creating a variable. Um, and then just creating dynamically that those blocks here so if I need to do any changes, I don't need to go to the definition of the policy document. I can go to my variable, local variable, do the change, and then any time I deploy again the policy document I will get that, uh, updated. So now, uh, let me continue with the next block because we did from pro to deaf and hybrid and we missed dev to hybrid. And now, the last thing I need to do is the attachment policy. So, I already have one attachment policy, which is um getting the the tag value uh of the attachment. And if the tag is inspection equal true, that means that it is an inspection BPC because the inspection BPCs have already connected to cloud one. And now I'm going to do two more attachment policies, uh, one based on the tag and another one based on the type of, uh, attachment. So give me a moment that I finish that piece. Of course, so what you can see here is that basically cloud AWS cloud one works with segments. These segments can, uh, can be across regions, and we are having depth segment, pro segment, and the security segment with AWS network firewall. If you want to automate this journey to. I mean, Amazon Que can do this or Kioko also has. Yeah, the question here is how to automate this even more using GAI and yeah, you can work with Quiro where you can work with Amazon Que developer. Remember the Amazon Q developer advise you like the next slide to write. It works also with a Tlos cloud. Mhm. So the other thing that we are really excited with Paulo, it's that we just got announced a couple of weeks ago. I don't know if somebody saw it that we are now having advanced routing with AWS Cloud One. Abd routing, it's a new function where like, you know, like adding many routes, like 100 routes, 1000 routes, like. Every, like, every day of the network engineers. So the idea with advanced routing is you can add now filters. You can now like inbound filter, outbound filter. You can summarize route. You can use BGP attributes, BT BGP metrics, so you can add that. So this can just to make easier the routing and your route tables. So it's freshly baked. So if you start implementing AWS cloud one, also can take advantage of this new feature. So back to you, Pablo. Yeah, so, uh, we have already created the new version of the policy document. Let me go to the console so I can show you how that works. So this is the AWS Network Manager console where cloud one, lives. If you have transit gates, you can also take advantage of these, uh, network manager capabilities by just, uh, importing the transit gates. But in cloud one it, it, it works natively, uh, so you see that, uh, my policy version, um. Uh, it's the 15th, uh, so we did a lot of dry runs before this session, um, that I have two different kind of aliases, uh, when I'm doing some changes. I have my life, uh, policy, which is the one that is currently deployed, the one without notice, uh, attachment, uh, the attachment policies, the service insertion routing and everything, and then the new version which is the one we have just, uh, created. That is going to take some time to deploy and once it's deployed, it will move to the live version of it. It will take some time, so, um, of course like it maybe it's time for some questions so and also, uh, maybe we can move to the next, uh, section if, uh, if it takes, uh, longer because usually it can take longer if it's adding new region, removing region can take, can take some minutes. Now that we're just creating some. Um, uh, some routing maybe doesn't take that much and also you see that what I have already created are my 3, inspection BPCs attached to the network, uh, function group inspection BPCs, so that piece is already there, um, so now we can, we can just create those, those specific routing so it's already been. Deploying everything, so it's telling you which actions apply. The attachment policies are just applied automatically. Now it's going to be creating all the static routes. Do we have any questions? Yes, I just have one in here, and that is if someone has permissions in the account level, can they like. Bypass the service control policy and the answer it's no service control policy will always be up or over the account level permission that you have. Yeah, exactly, and there was a question over there. Did you, uh, so you got you define where all the what regions are your inspection UPCs was that it looked like did you also tell them whether you're, uh, inspecting on both the source and destination region or just one of them? Is that part of it? Can you repeat that? I need you are inspecting both source and destination in service insertion when you say, so let me come back to the definition, um, so when you say, uh, where I have it here like deaf to hybrid also is hybrid from to death, so it's bidirectional when you do it. So it's going to be between source and destination, yeah, you're going from US. Yeah, so now that's where I define that for example between uh USC 1 and EU South 2, so Spain I'm saying that I, I only want to inspecting US in North Virginia. I can say by defining here, uh, dual hop that I want to be inspecting in, in the two in both, but in that case we're doing single single hop for the sake of the example. Cool. Then while we create um AWS Cloudon I think we can move to the 3rd requirement uh and then of course we have everything connected uh connected together. OK, so, uh, what have we created so far? Uh, so basically we have all these we have the inspection between routing domains, we have the re inspection, we have the cross region and the attachment automation. Um, do you think that we have met all these requirements? Or are we missing anything? I think we're missing something, Paulo. Yes, so, thing is, um, I, we can do it, so we can, we can meet that one easily by just simply saying to everyone, hey, put the. Your OU tag uh when you connect your VPC uh or doing in the account factory that we mentioned before doing it by default that they don't need to do it but what if someone puts the wrong value of the tag domain. Uh, they may be connecting to hybrid. They may be connecting to prod. So still we need for our use case or requirement of I want to make sure that, uh, new VPCs go to the right, uh, to the right segment and the way we define the, the policy document we need a little bit of extra help to make that requirement, uh, to be met. And that's how we're going to enforce routing domains from OU using again AWS organizations and AWS uh step functions. So, as we did with the VPCs, we're going to create another service control policy for the Spo OU and the Spo accounts that they won't be able to create the tag domain. Uh, it will be created from the networking account. Uh, so they can create any tags in the attachment but not the tag domain because that's the one that defines in which segment they're connecting and we want to do it from the networking account. Um, once we do that, that's going to be denied, so they're going to be creating the attachment to nowhere in cloudbo, so it's just an attachment without any association. And now what we're doing is as part of Network Manager we have the capability to get events from changes in the network. Uh, AWS Network Manager events are sent to EvenBridge. I'm showing there Oregon and why I'm showing Oregon because, um, the home region of AWS Cladon where the control plane resides is is Oregon. So all the, uh, metrics and the events are going to be populated into that region. So, or even Bridge is going to catch those events. We're going, we're going to filter by only new VPC attachments. I don't want to get much events, only those ones, and I'm going to send the two step functions to do this logic. Wait for the VPC attachment creation that most likely just like a measure to make sure that we don't start doing the logic before the attachment is created. I'm going to obtain the OU information from the um from the account ID because that's metadata that I get from the event. And I'm going to create the tag from the uh networking account so we will see how after the attachment is created it changes from no segment to the segment we want to be uh we want to be connecting so that's what we're going to do right now. Perfect. So we had a question back there and I'm going to move now for that one that um the thing here is yes we are using AWS cloud one to deploy the network but service control policies is the one that is helping us from someone to not deploying the things that we don't want as Paulo and I as the network specialist to be deployed. Uh, so yeah, as you saw at the beginning, there was only IPAN and service control policies. There were no AWS cloud one just to show you that you cannot, uh, like bypass service control policy or deploy other RPLSs that are not allowed, but it's not because for IPA or AWS cloud one is for service control policies. And I think we have another question in here. What, what's the question? Yeah, the testing. OK, yes, so once we create the, uh, new policy for cloud band, right, it's generated and we see it's, you know, we have a latest one and we have a current one. Is there a way to test connectivity before finally applying it and if it fails to go to previous version? So currently we don't have that option. So you can, you can of course when you create the new policy, you can check what is changing. Before you, uh, from terraform or cloud formation, it will do the approval automatically to not break the infrastructures code, uh. Um, way of working, but if you do it from the console, you can of course check what it's doing and see if there's any destroy action. Currently we don't have the way to test that before life. What we have, uh, um, created recently is a cloud on MCP that kind of helps you with different tools how to quickly check if if the routing is happening once you have it in life that policy document. And then of course you can always roll back to previous options uh if you if you don't so there's I think that there was. Yeah, so, so you can use reachability analyzer. Man. Policies in my my stuff if it's not met, yeah, yeah, so, so, so we are exactly so those tools are the ones used, but then you need the coordinator policy already live so we're of course working to ways because feedback is also like I may want to check this before I have it created. Uh, so we're working on, on that, but for now it needs to be live. Then of course use tools, uh, to understand if the network is properly defined. But if not, you can quickly roll back to the previous version of the policy, uh, via API or via the console and then continue with your, with your deployment. So, let me go quick to the service control policy that I'm going to let create while I'm uh explaining everything. So what I'm doing is I'm denying the creation of any VPC attachment. Uh, if, uh, there's this, uh, domain, uh, uh, there's this domain key, uh, and of course denying any tag modifications. I'm not allowing anyone to change the domain tag once it is created. So I'm doing that at the dev uh OU, um, level, um, and now I'm going to be, uh, building the automation. I'm going to cheating on the automation side because I have almost created. I just. Um, I'm going to, it's coded. I'm just going to, um, uncom it and we can discuss it, discuss it while I'm, uh, what it's getting built. Uh, so I'm creating this from the networking account. OK, so the automation is what we mentioned before, the even bridge rule that is capturing only VPC attachments and capturing the network manager events, but only the ones that are VPC attachment created. That's the only thing that's important right now, and I'm sending this to uh to step functions and to see exactly what, uh, what I'm creating a step function is always better to check it from the, from the console. Uh, you have a better, better UI. And yes, if I go to my state machine to the definition, so it's here, let me make it bigger. Um, that's what uh we're doing. So we are uh getting the VPC attachment, uh, just to first check if it if the attachment is created. Uh, majority of the times is going to be created already, just um kind of like a safety measure. And then I'm obtaining the organizational unit from the account ID. Getting the domain from that uh from that OU. So in that case we're making it simpler because the OU name is the name of the, uh, segment in cloud one. But here this step is maybe if you have extra logic that OK OU means non-pro uh to add an extra logic in the in the step, and then we're creating the tag in cloud one. So basically are 34 steps that allows us to uh get this extra logic. Into into AWS cloud one. So, yeah, so, with that, Perfect. So, with that, we have built. Uh, this, or we have built those, those requirements, uh, applying the best practices that we mentioned before, no? So with AWS organizations what we're doing is not, uh, putting the efforts on blocking actions that they shouldn't happen at the network level. Uh, by, uh, by just simply like denying actions or putting a firewall when, uh, we need to or just to thinking that OK, I don't trust anyone, so I would kind of own everything. Now what we're doing is creating those guardrails in organizations, so it's OK. Uh, no one is going to put up a cyder block that it shouldn't be or it can be no one is going to put in their VPC and a gateway so I don't need to just freak out if. Uh, or not allowing them to do specific actions. I know that they cannot put on a gateway. So yeah, uh, go free and, uh, work with your VPC because it's your workload. So you should also work with your own network for that. Then with cloud one we build a global network in 3 AWS regions with less than 50 lines of code. No, so we will see later how VPCs will automatically connect and the routing will be created, um, automatically. And then finally, uh, we had a step function. So we had, uh, this ad hoc requirement that the. Uh, that we needed to build some automation on top of that and then we use 5 states to ensure that VPCs are only being associated and, uh, to their corresponding uh segment. So now let's go and try it out, um, uh, where we have, we're going to finish the definition of our three VPCs. We have a, uh, a data center, well, it's a VPC in Paris that is going to mimic a data center and we're going to do a VPN and we're going to see how, uh, the VP, the side to side VPN is going to get connected directly in the hybrid segment and our spokes VPCs are going to first create it to know, to know, uh, segment and then our automation is going to kick in. And move them to the domain uh routing domain and then we're going to show, uh, how the automation works and uh get some more, uh, and show you more about the configuration on cloud one, before we uh finish the, the session. So yeah, so let me come back to the coding piece. Yeah, so in here you can see that we have been working mostly with uh Amazon BPCs, but AWS cloud one can work with Amazon BPCs, AWS side to side VPN, AWS Direct Connect. It can, uh, pair with AWS Transit careway also with. AWS transit that we connect that it's the solutions to work with SD1. So in here is that you can work with AWS cloud one not only with Amazon VPC but also to help you deploying the routing and everything that you need for the hybrid connections that it's pretty usual for many of our customers. Yeah, so right now what I'm doing is, uh, as part of the, um, VPC module, the, the way to create the core network attachment is to defining, OK, this is my core network that was created, and that's why I have a local, a uh a variable because I'm checking that ID or that ARN from, um, from AWS uh RAM, and here I'm putting just the routes. So basically I'm sending any IPB 4 traffic or any IPB 6 traffic. To the core network uh attachments and the last thing I need to do is to create the subnet where I'm going to be placing that um. Uh, that attachment and I'm making it, uh, dual stack by assigning an IPV6 block and this is just part of the configuration in the module. Just we're saying that it doesn't require any, uh, acceptance because in cloud one you can also put, uh, some controls about do do I want to accept the attachment before it automatically, uh, connects to a segment or not so I can add some manual value. In our case we didn't want to. That's why we build the automation to control that. But if you don't want to build that automation, you can add some manual control and just simply get notified when you have a new VPC to check it and maybe to approve the uh the association. I'm cheating a little bit because I have already my um private module just to create easy to instances and instant uh and some end points to connect to. I don't think we will have time today to show end to end connectivity, but just in case, uh, we have the time, uh, we are building some some easy to instances. So now I'm going to do the same in the rest of the of the environment. Yeah, any, any questions? OK. Perfect. OK, so that's on this spoke account. I already have everything. Let's make sure that. I did not mess up something. Hey, um, is it possible to set up custom error messages? Yeah, I did something SCPs. Um, I did all of them blocked. Let me check for the users, yeah, because we've avoided using SEPs for like tax enforcement, uh, out of fear that internal customers won't understand why I'm just doing a split so I need to take the second item which is the ID from the ARM. That's what I'm doing in this specific section. So now it should. It should give me everything good. What's the question there, Claudia? Yeah, we have the question that if we can send a message to customers that they are getting blocked by service control policy because they usually don't understand why they are getting blocked when they're trying to do something that service control policy is not allowing because it was configured that way. I don't know, uh, maybe, uh, we will need to, um. I have no don't know if that's possible or not. Uh, maybe we can take that later and then do a little bit of quick research if it's possible or get you to the right person to, to answer that, but I, I don't know. I don't know. And then the last one is on the on-prem side. I have already created the VPN so I have my customer gateway, my VPN connection, and the only thing I'm going to be creating is the, uh, side to side VPN attachment. So now once I create it, um, I can move and show uh how everything has been, um, has been created. And uh and just see how the different automation is working and how everything is getting connected to cloud and so let's uh turn the network inside so it's not creating anything. I know, I need to be in the on-prem one, sorry. So the on-prem, so the VPN, even though I have another term from the states, I'm working kind of independently for the on-prem site, it's getting built in the networking account that, uh, and this is why the side to side VPN attachment needs to be created, uh, the attachment maybe, uh, on the VPN needs to be created in the same account where cloud one, resides. That's kind of same, uh, um, the same way it works on the, on the transit gateway. So, let's go to our uh console to see that now we have our VPN and the VPN already is getting associated to the hybrid segment uh thanks to the 300 policy attachment policy configuration which is the one we can show you now from the console so you can see how uh all the logic and and everything. And now the VPCs for now they're just being created without any segment. We will come back to them. To the attachment stuff in a moment to see how they moved uh look at uh for example the one in Spain already got created and it's moving already to the death segment so now it's just pending the network update of the association and the propagation in that specific segment. So before that, let's go and check the policy version and then we see kind of how everything is working. So even though we did a data source, uh, cloud one works with Jason. So, uh, what we did or what it was already created was the ASN ranges. So, uh, any EPU in in Cloud one is, uh, using EBGP. So we need to provide the range of ASNs that we want in the, in the regions. Then the edge locations in which regions we want to create cloud one. So in that case, 3 regions only. And then we have the attachment policies. I already explained this one at the when we were doing that part of the code, but then the the logic for the VPCs was, hey, uh, if um if the attachment type is a VPC. And also the tag domain exists. I did a typo here. This should have been an end. We can even update it, uh, later in a moment. Uh, if these two conditions are met, I want you to, uh, put you in the two, like I want to put you in the, um, segment that has the same name. As the value of the tag domain, so with this, uh, attachment policy I'm covering all the possible use cases for my VPCs if I do that logic of, uh, OU name segment or your own logic that you want to do in cloud one. And then the last one is, hey, if any of these attachments, uh, are connected, so any set to set VPN connect attachment or direct connect gateway, I want you to put it in the hybrid segment so I make sure that anything that is hybrid goes to that, uh, routing domain. And then I configure my network function group for my inspection BBC's and my three segments, uh, dev, hybrid, and prod. Uh, we didn't use prod today, but it's just, uh, to show you as an example of how you can create different segmentation in, in cloud one. And then lastly we have the segment actions, uh, as we were mentioning before, now we have routing policies to get you to do more advanced routing controls, so filtering, summarization. Advanced, uh, BGP capabilities like changing the AS path, changing the local prev, or changing BGP communities, uh, but in that case we're showing you how you can insert, uh, firewalls. So, uh, so basically we have the, um, the send to action. It creates a static route, uh, pointing to kind of a default for egress traffic to the inspection. Uh, but then we also have the, um, single hop the send via to, uh, to the, uh, between the different segments, and here you see that even though in my policy document I created the dynamic block, um, when it translated to Jason it creates the. Override. So basically between these two regions I want to use the first one and then everything that we define in the local, uh, in the local variable and then we have it both for prot to dev and hybrid and then uh from dev to hybrid so we cover all the different use cases. And let's go to attachments. How much time do we have? OK, we have some time, so we're good. So, you see now that the 3 VPCs already moved to that. So let's go to our state machine to see how, why that happened. So, we see 3 executions. So it was our 3 VPCs moving already to um uh getting created, so getting the notification to even bridge and coming to step function. So, let's pick one as an example to show you what happened, so. Here what I did is obtaining the VPC attachment and I was uh obtaining three things, 3 variables in my um in in step functions. First of all, the AWS account basically from the input getting the attachment ARM and I'm getting the account where the VPC was created. The attachment ARM, uh, and then the attachment, uh. ID first, uh, choices, uh, choices state that just checking. That uh from here I'm getting the VPC attachment so I'm also obtaining the status of the VPC attachment if it's available. So if it's created, I just move to the next uh state that I'm getting the organizational unit. So from the, uh, account ID I'm getting the organizational unit and in the other one I'm getting the name of the organizational unit and the only thing I'm doing now is tagging that attachment so doing the. Um, the cool thing in step functions is I don't need to be lamb lambdas like into step functions provide native integration to majority of the uh AWS APIs. So I'm just directly calling the, uh, the APIs for those services. I'm tagging the attachment with the dev, uh, domain, uh, equals dev. So if I come to my VPCs. Uh, I see that, uh, the, the tag is already there. In domain def and the cool thing is that if now I'm in the spoke account and if I go to cloud one, and I check my attachment because that was created in the Spoke account um so it is shared uh no share with me, so here, here I have it, uh, I see my, I don't see the core network but I see the attachments that I created for the core network I was share uh that they shared with me. I can also see those tags, uh, something cool, uh, because for the ones you know like when when you do AWS RAM, the tags are not shared between accounts, but cloud one is sharing those tags between accounts so you can see and potentially control unless we block it as we did it today. You can also check the tag of of that attachment so you understand better why my attachment was connected to the. Um, to the segment, but also, for example, because it's a shared resource, I don't know what I'm connected to. I'm just simply connected to Cloudon and I trust my networking team to have built all the, uh, routing, uh, all the routing for me. OK. So, I think with that we can start closing it up. Um First, like, yes, so yeah, there is a repo you can start working with AWS cloud one service control policy. Everything is a sample is the official report that where you can find these and many other solutions. And also you can start working with AWS cloud one specifically with guidance for attachment. Uh, before you move, um, so in the cloud and blueprints we already moved to version one, and you have even examples for this advanced routing with routing policies. Um, feel free to check it, create issues, create PRs. We're really happy to get at least these blueprints where we can interact, uh, with you, and you can tell us, OK, I want to see that specific use case. The guidance solution, it's basically the same idea that we see, we saw with the step functions, but. Uh, for production real environments or thinking on production real environment so it helps you to create this extra logic into the attachment in the man in the attachment management of cloud and if you want to add those extra controls aside the attachment policy and then of course some examples on service control policies, yeah, sorry, don't worry. And then we have also ADSkillBuilder. This is the platform where you can find many different courses for free. Some of them, and other one needs to be paid. And yes, we have specifically for network and content delivery you can find in here more about Aulus cloud one and other networking services. And, as I said, uh, at the beginning of the session today, some key takeaways. You, you can forget everything that we said so far. This is the important piece, uh, so, uh, the first one is architect by use case, not by habit. So, um, what we have seen so far in customers is like as they're growing, they are just putting, uh, one specific service because. That's where they found in the documentation or that's where uh they're com uh comfortable with or their partner is comfortable with and then everything needs to operate around this architecture decision um we see success doing the opposite uh what's your use case that's why we're here tell us your use case and we can help you uh define which is the best service for your specific use case. Um, and then the sec and then of course like the the idea is like you don't have one service for everything, um, I know that it's of course like you you need to be in the middle like not like hey yeah let's use all the portfolio of AWS networking to do connectivity but for sure it's not only one like uh we need to get like defined properly the use cases and make sure that we have the right pattern for the use case. Uh, and for that we need to start with business outcomes and then architect for agility so understand where we want to get where we want the business to, uh, to when and where they want to, to reach that goals, and then architect for agility, uh, infrastructures called modular designs continuous iteration, uh, most likely you have really well defined pipelines and automation in your applications take those learnings and put it also in your infrastructure. So you can also have that iteration and services like cloud one helps you to not have to control big infrastructures code uh files with so many uh resources you have everything in one single uh place and they orchestrate beyond networking we see that not only networking is the key uh service control policies, organizations, security measures, um, automation take. Uh, full control of the portfolio of, uh, of AWS also to build the infrastructure, uh, that you want to get, to get your business, uh, quick and, uh, to the goals that you, you have been setting up. So with that, thank you very much.